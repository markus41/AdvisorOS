<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(21)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(21) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(21) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(21) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>QuickBooks Setup | AdvisorOS Documentation</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="QuickBooks Setup" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Implementation, adoption, and operations playbook for AdvisorOS." /> <meta property="og:description" content="Implementation, adoption, and operations playbook for AdvisorOS." /> <meta property="og:site_name" content="AdvisorOS Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="QuickBooks Setup" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Implementation, adoption, and operations playbook for AdvisorOS.","headline":"QuickBooks Setup","url":"/QUICKBOOKS_SETUP.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> AdvisorOS Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/wiki/" class="nav-list-link">AdvisorOS Wiki</a></li><li class="nav-list-item"><a href="/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/business/" class="nav-list-link">Business Overview</a></li><li class="nav-list-item"><a href="/FEATURES.html" class="nav-list-link">Product Capabilities</a></li><li class="nav-list-item"><a href="/strategic/" class="nav-list-link">Strategic Documentation</a></li><li class="nav-list-item"><a href="/QUICK_START.html" class="nav-list-link">Executive Quick Start</a></li><li class="nav-list-item"><a href="/README.html" class="nav-list-link">Documentation Home</a></li><li class="nav-list-item"><a href="/technical/" class="nav-list-link">Technical Hub</a></li><li class="nav-list-item"><a href="/integrations/" class="nav-list-link">Integrations Hub</a></li><li class="nav-list-item"><a href="/security/" class="nav-list-link">Security & Compliance</a></li><li class="nav-list-item"><a href="/ARCHITECTURE.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item"><a href="/API_REFERENCE.html" class="nav-list-link">API Reference</a></li><li class="nav-list-item"><a href="/USER_GUIDE_COMPREHENSIVE.html" class="nav-list-link">User Guide (Comprehensive)</a></li><li class="nav-list-item"><a href="/README_USER.html" class="nav-list-link">Implementation Runbook</a></li><li class="nav-list-item"><a href="/CLIENT_PORTAL_GUIDE.html" class="nav-list-link">Client Portal Guide</a></li><li class="nav-list-item"><a href="/DATABASE.html" class="nav-list-link">Database Guide</a></li><li class="nav-list-item"><a href="/DEVELOPER_SETUP_ENHANCED.html" class="nav-list-link">Developer Environment Setup</a></li><li class="nav-list-item"><a href="/DEPLOYMENT.html" class="nav-list-link">Deployment Guide</a></li><li class="nav-list-item"><a href="/ADMINISTRATOR_GUIDE.html" class="nav-list-link">Administrator Guide</a></li><li class="nav-list-item"><a href="/INTEGRATION_GUIDES.html" class="nav-list-link">Integration Guides</a></li><li class="nav-list-item"><a href="/QUICKBOOKS_SETUP.html" class="nav-list-link">QuickBooks Setup</a></li><li class="nav-list-item"><a href="/README_DEV.html" class="nav-list-link">Developer Setup</a></li><li class="nav-list-item"><a href="/TROUBLESHOOTING.html" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operations Command Center category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/operations/" class="nav-list-link">Operations Command Center</a><ul class="nav-list"><li class="nav-list-item"><a href="/operations/incident-response.html" class="nav-list-link">Incident Response Playbook</a></li><li class="nav-list-item"><a href="/operations/RUNBOOK.html" class="nav-list-link">Operations Runbook</a></li><li class="nav-list-item"><a href="/operations/DEPLOYMENT_GUIDE.html" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/compliance/README.html" class="nav-list-link">Compliance Overview</a></li><li class="nav-list-item"><a href="/architecture/adrs/001-multi-tenant-data-isolation.html" class="nav-list-link">ADR-001: Multi-Tenant Data Isolation Strategy</a></li><li class="nav-list-item"><a href="/architecture/adrs/002-prisma-schema-design.html" class="nav-list-link">ADR-002: Prisma Schema Design and Relationships</a></li><li class="nav-list-item"><a href="/architecture/adrs/003-nextjs-app-router-api-design.html" class="nav-list-link">ADR-003: Next.js App Router Structure and API Design</a></li><li class="nav-list-item"><a href="/architecture/adrs/004-azure-infrastructure-scaling.html" class="nav-list-link">ADR-004: Azure Infrastructure Choices and Scaling Strategy</a></li><li class="nav-list-item"><a href="/architecture/adrs/005-security-architecture-compliance.html" class="nav-list-link">ADR-005: Security Architecture and Compliance Framework</a></li><li class="nav-list-item"><a href="/api/" class="nav-list-link">AdvisorOS API Documentation</a></li><li class="nav-list-item"><a href="/admin/" class="nav-list-link">AdvisorOS Administrator Documentation</a></li><li class="nav-list-item"><a href="/architecture/ARCHITECTURE_AUDIT_SUMMARY.html" class="nav-list-link">AdvisorOS Architecture Audit Summary</a></li><li class="nav-list-item"><a href="/COST_OPTIMIZATION_STRATEGY.html" class="nav-list-link">AdvisorOS Cost Optimization Strategy</a></li><li class="nav-list-item"><a href="/developer/" class="nav-list-link">AdvisorOS Developer Documentation</a></li><li class="nav-list-item"><a href="/FAQ_TROUBLESHOOTING.html" class="nav-list-link">AdvisorOS FAQ &amp; Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/PRODUCTION_READINESS_CHECKLIST.html" class="nav-list-link">AdvisorOS Production Readiness Checklist</a></li><li class="nav-list-item"><a href="/architecture/TECHNICAL_DEBT_ANALYSIS.html" class="nav-list-link">AdvisorOS Technical Debt Analysis and Improvement Roadmap</a></li><li class="nav-list-item"><a href="/templates/TECHNICAL_DOC_TEMPLATE.html" class="nav-list-link">AdvisorOS Technical Doc Template</a></li><li class="nav-list-item"><a href="/user-guide/" class="nav-list-link">AdvisorOS User Guide</a></li><li class="nav-list-item"><a href="/architecture/adrs/" class="nav-list-link">Architectural Decision Records (ADRs)</a></li><li class="nav-list-item"><a href="/admin/infrastructure/azure-deployment.html" class="nav-list-link">Azure Deployment Guide for AdvisorOS</a></li><li class="nav-list-item"><a href="/api-specs/endpoints.html" class="nav-list-link">CPA Platform API Specifications</a></li><li class="nav-list-item"><a href="/design-system/components.html" class="nav-list-link">CPA Platform Design System - Components</a></li><li class="nav-list-item"><a href="/api/routes/client.html" class="nav-list-link">Client Management API</a></li><li class="nav-list-item"><a href="/user-guide/cpa-firms/client-management.html" class="nav-list-link">Client Management Guide</a></li><li class="nav-list-item"><a href="/user-guide/clients/client-portal-guide.html" class="nav-list-link">Client Portal User Guide</a></li><li class="nav-list-item"><a href="/user-guide/cpa-firms/getting-started.html" class="nav-list-link">Getting Started with AdvisorOS</a></li><li class="nav-list-item"><a href="/compliance/soc2/overview.html" class="nav-list-link">SOC 2 Type II Compliance Overview</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/markus41/AdvisorOS/blob/main/ADVISOROS_COMPREHENSIVE_ENHANCEMENT_PORTFOLIO.md" class="nav-list-link external" > Product Overview (PDF) <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AdvisorOS Documentation" aria-label="Search AdvisorOS Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/markus41/AdvisorOS" class="site-button" > AdvisorOS on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="quickbooks-integration-setup-guide"> <a href="#quickbooks-integration-setup-guide" class="anchor-heading" aria-labelledby="quickbooks-integration-setup-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> QuickBooks Integration Setup Guide </h1> <h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents </h2> <ol> <li><a href="#overview">Overview</a></li> <li><a href="#prerequisites">Prerequisites</a></li> <li><a href="#quickbooks-app-setup">QuickBooks App Setup</a></li> <li><a href="#platform-configuration">Platform Configuration</a></li> <li><a href="#client-connection-process">Client Connection Process</a></li> <li><a href="#data-synchronization">Data Synchronization</a></li> <li><a href="#webhook-configuration">Webhook Configuration</a></li> <li><a href="#testing-integration">Testing Integration</a></li> <li><a href="#production-deployment">Production Deployment</a></li> <li><a href="#troubleshooting">Troubleshooting</a></li> <li><a href="#best-practices">Best Practices</a></li> <li><a href="#support-and-resources">Support and Resources</a></li> </ol><hr /> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <p>The CPA Platform integrates with QuickBooks Online using Intuit’s OAuth 2.0 API to provide seamless synchronization of financial data. This integration allows CPAs to:</p> <ul> <li>Import client financial data automatically</li> <li>Sync chart of accounts, customers, and transactions</li> <li>Generate reports using real-time QuickBooks data</li> <li>Maintain data consistency between platforms</li> </ul> <h3 id="integration-features"> <a href="#integration-features" class="anchor-heading" aria-labelledby="integration-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Integration Features </h3> <ul> <li><strong>Real-time Synchronization</strong>: Automatic data sync with configurable frequency</li> <li><strong>Selective Sync</strong>: Choose which data types and date ranges to synchronize</li> <li><strong>Webhook Support</strong>: Real-time notifications of QuickBooks data changes</li> <li><strong>Error Handling</strong>: Robust error handling with retry mechanisms</li> <li><strong>Audit Trail</strong>: Complete logging of sync activities and data changes</li> </ul> <h3 id="architecture-overview"> <a href="#architecture-overview" class="anchor-heading" aria-labelledby="architecture-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture Overview </h3><pre><code class="language-mermaid">graph TB
    subgraph "CPA Platform"
        API[Platform API]
        SYNC[Sync Service]
        DB[(Database)]
        WEBHOOK[Webhook Handler]
    end

    subgraph "QuickBooks Online"
        QB_API[QuickBooks API]
        QB_DATA[(QB Company Data)]
        QB_WEBHOOK[QB Webhooks]
    end

    subgraph "Intuit Services"
        OAUTH[OAuth 2.0]
        DISCOVERY[Discovery Document]
    end

    API --&gt; OAUTH
    OAUTH --&gt; QB_API
    SYNC --&gt; QB_API
    QB_API --&gt; QB_DATA
    QB_WEBHOOK --&gt; WEBHOOK
    SYNC --&gt; DB
    WEBHOOK --&gt; DB
</code></pre><hr /> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <h3 id="intuit-developer-account"> <a href="#intuit-developer-account" class="anchor-heading" aria-labelledby="intuit-developer-account"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Intuit Developer Account </h3> <ol> <li><strong>Create Intuit Developer Account</strong>: <ul> <li>Visit <a href="https://developer.intuit.com">https://developer.intuit.com</a></li> <li>Sign up for a developer account using your Intuit ID</li> <li>Complete the developer profile setup</li> </ul> </li> <li><strong>Verify Your Account</strong>: <ul> <li>Confirm your email address</li> <li>Complete any required verification steps</li> <li>Access the Intuit Developer Dashboard</li> </ul> </li> </ol> <h3 id="technical-requirements"> <a href="#technical-requirements" class="anchor-heading" aria-labelledby="technical-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Requirements </h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Required software versions</span>
Node.js: 18.x or higher
npm: 10.x or higher
OpenSSL: For SSL certificate generation <span class="o">(</span>development<span class="o">)</span>

<span class="c"># Required knowledge</span>
OAuth 2.0 flow understanding
REST API development experience
Webhook handling concepts
</code></pre></div></div> <h3 id="platform-requirements"> <a href="#platform-requirements" class="anchor-heading" aria-labelledby="platform-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Platform Requirements </h3> <ul> <li>Active CPA Platform deployment</li> <li>SSL certificate for webhook endpoints</li> <li>Database access for storing QuickBooks data</li> <li>Admin access to configure integration settings</li> </ul><hr /> <h2 id="quickbooks-app-setup"> <a href="#quickbooks-app-setup" class="anchor-heading" aria-labelledby="quickbooks-app-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> QuickBooks App Setup </h2> <h3 id="create-new-app"> <a href="#create-new-app" class="anchor-heading" aria-labelledby="create-new-app"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create New App </h3> <ol> <li><strong>Access Developer Dashboard</strong>: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://developer.intuit.com/app/developer/myapps
</code></pre></div> </div> </li> <li><strong>Create New App</strong>: <ul> <li>Click “Create an app”</li> <li>Choose “QuickBooks Online and Payments”</li> <li>Select appropriate scopes: <ul> <li><code class="language-plaintext highlighter-rouge">com.intuit.quickbooks.accounting</code> (Required)</li> <li><code class="language-plaintext highlighter-rouge">com.intuit.quickbooks.payment</code> (If using payments)</li> </ul> </li> </ul> </li> <li><strong>App Configuration</strong>: <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">App Name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">CPA</span><span class="nv"> </span><span class="s">Platform</span><span class="nv"> </span><span class="s">Integration"</span>
<span class="na">App Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Professional</span><span class="nv"> </span><span class="s">accounting</span><span class="nv"> </span><span class="s">platform</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">CPA</span><span class="nv"> </span><span class="s">firms"</span>
<span class="na">App Logo</span><span class="pi">:</span> <span class="na">Upload your platform logo (recommended</span><span class="pi">:</span> <span class="s">256x256 px)</span>
<span class="na">Website URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://your-cpa-platform.com"</span>
</code></pre></div> </div> </li> </ol> <h3 id="configure-oauth-settings"> <a href="#configure-oauth-settings" class="anchor-heading" aria-labelledby="configure-oauth-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure OAuth Settings </h3> <ol> <li><strong>Development Settings</strong>: ```yaml Redirect URIs: <ul> <li>https://localhost:3000/api/auth/quickbooks/callback</li> <li>https://your-domain.com/api/auth/quickbooks/callback</li> </ul> <p>Logout URL: https://your-domain.com/logout</p> <p>Webhooks URL: https://your-domain.com/api/webhooks/quickbooks ```</p> </li> <li><strong>Production Settings</strong>: ```yaml Redirect URIs: <ul> <li>https://your-production-domain.com/api/auth/quickbooks/callback</li> </ul> <p>Logout URL: https://your-production-domain.com/logout</p> <p>Webhooks URL: https://your-production-domain.com/api/webhooks/quickbooks ```</p> </li> </ol> <h3 id="obtain-app-credentials"> <a href="#obtain-app-credentials" class="anchor-heading" aria-labelledby="obtain-app-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Obtain App Credentials </h3> <ol> <li><strong>Development Credentials</strong>: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Navigate to App Keys &amp; OAuth in your app settings</span>
Client ID: Your sandbox client ID
Client Secret: Your sandbox client secret
Environment: Sandbox
Discovery Document: https://developer.api.intuit.com/.well-known/connect_uri_sandbox
</code></pre></div> </div> </li> <li><strong>Production Credentials</strong>: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Production keys (available after app review)</span>
Client ID: Your production client ID
Client Secret: Your production client secret
Environment: Production
Discovery Document: https://developer.api.intuit.com/.well-known/connect_uri
</code></pre></div> </div> </li> </ol> <h3 id="app-submission-for-production"> <a href="#app-submission-for-production" class="anchor-heading" aria-labelledby="app-submission-for-production"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> App Submission for Production </h3> <ol> <li><strong>Prepare for Review</strong>: <ul> <li>Complete all required app information</li> <li>Test thoroughly in sandbox environment</li> <li>Prepare app review materials: <ul> <li>Demo video showing integration</li> <li>Privacy policy URL</li> <li>Terms of service URL</li> <li>Support contact information</li> </ul> </li> </ul> </li> <li><strong>Submit for Review</strong>: <ul> <li>Click “Submit for Review” in developer dashboard</li> <li>Provide detailed description of data usage</li> <li>Wait for Intuit’s approval (typically 5-10 business days)</li> </ul> </li> </ol><hr /> <h2 id="platform-configuration"> <a href="#platform-configuration" class="anchor-heading" aria-labelledby="platform-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Platform Configuration </h2> <h3 id="environment-variables"> <a href="#environment-variables" class="anchor-heading" aria-labelledby="environment-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment Variables </h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add to your .env.local (development) or production environment</span>
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span>your_sandbox_client_id
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span>your_sandbox_client_secret
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span>sandbox
<span class="nv">QUICKBOOKS_DISCOVERY_DOCUMENT</span><span class="o">=</span>https://developer.api.intuit.com/.well-known/connect_uri_sandbox

<span class="c"># Production</span>
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span>your_production_client_id
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span>your_production_client_secret
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span>production
<span class="nv">QUICKBOOKS_DISCOVERY_DOCUMENT</span><span class="o">=</span>https://developer.api.intuit.com/.well-known/connect_uri

<span class="c"># Webhook configuration</span>
<span class="nv">QUICKBOOKS_WEBHOOK_VERIFIER_TOKEN</span><span class="o">=</span>your_webhook_verifier_token
</code></pre></div></div> <h3 id="database-schema-updates"> <a href="#database-schema-updates" class="anchor-heading" aria-labelledby="database-schema-updates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Schema Updates </h3> <p>The platform includes QuickBooks-specific database tables. Ensure they’re properly migrated:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run database migrations</span>
npx prisma migrate deploy

<span class="c"># Verify QuickBooks tables exist</span>
npx prisma studio
<span class="c"># Check for: quickbooks_tokens, quickbooks_syncs, quickbooks_webhook_events</span>
</code></pre></div></div> <h3 id="service-configuration"> <a href="#service-configuration" class="anchor-heading" aria-labelledby="service-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service Configuration </h3> <ol> <li><strong>QuickBooks Service Configuration</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/services/quickbooks.service.ts</span>
<span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">sandbox</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">discoveryDocument</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://developer.api.intuit.com/.well-known/connect_uri_sandbox</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">baseUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://sandbox-quickbooks.api.intuit.com</span><span class="dl">'</span>
  <span class="p">},</span>
  <span class="na">production</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">discoveryDocument</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://developer.api.intuit.com/.well-known/connect_uri</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">baseUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://quickbooks.api.intuit.com</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div> </div> </li> <li><strong>OAuth Configuration</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/auth/quickbooks-oauth.ts</span>
<span class="kd">const</span> <span class="nx">oauthConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">client_id</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">QUICKBOOKS_CLIENT_ID</span><span class="p">,</span>
  <span class="na">client_secret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">QUICKBOOKS_CLIENT_SECRET</span><span class="p">,</span>
  <span class="na">redirect_uri</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXTAUTH_URL</span><span class="p">}</span><span class="s2">/api/auth/quickbooks/callback`</span><span class="p">,</span>
  <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.intuit.quickbooks.accounting</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">state</span><span class="p">:</span> <span class="nx">generateRandomState</span><span class="p">(),</span> <span class="c1">// CSRF protection</span>
<span class="p">};</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="client-connection-process"> <a href="#client-connection-process" class="anchor-heading" aria-labelledby="client-connection-process"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Client Connection Process </h2> <h3 id="oauth-flow-implementation"> <a href="#oauth-flow-implementation" class="anchor-heading" aria-labelledby="oauth-flow-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OAuth Flow Implementation </h3> <ol> <li><strong>Initiate Connection</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/quickbooks/connect/route.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NextRequest</span><span class="p">,</span> <span class="nx">NextResponse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">generateAuthUrl</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/lib/services/quickbooks-oauth.service</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">POST</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">NextRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">authUrl</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateAuthUrl</span><span class="p">({</span>
      <span class="nx">organizationId</span><span class="p">,</span>
      <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.intuit.quickbooks.accounting</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">state</span><span class="p">:</span> <span class="nx">generateSecureState</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">authUrl</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Failed to generate auth URL</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">500</span> <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Handle OAuth Callback</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/auth/quickbooks/callback/route.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">NextRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">searchParams</span> <span class="p">}</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">code</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">state</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">realmId</span> <span class="o">=</span> <span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">realmId</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Verify state parameter</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">verifyState</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>

    <span class="c1">// Exchange code for tokens</span>
    <span class="kd">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">exchangeCodeForTokens</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">realmId</span><span class="p">);</span>

    <span class="c1">// Store tokens securely</span>
    <span class="k">await</span> <span class="nx">storeQuickBooksTokens</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">tokens</span><span class="p">,</span> <span class="nx">realmId</span><span class="p">);</span>

    <span class="c1">// Trigger initial sync</span>
    <span class="k">await</span> <span class="nx">initiateInitialSync</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/settings/integrations?status=connected</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/settings/integrations?status=error</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="token-management"> <a href="#token-management" class="anchor-heading" aria-labelledby="token-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Token Management </h3> <ol> <li><strong>Store Tokens Securely</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">storeQuickBooksTokens</span><span class="p">(</span>
  <span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
  <span class="nx">tokens</span><span class="p">:</span> <span class="nx">TokenResponse</span><span class="p">,</span>
  <span class="nx">realmId</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">encryptedAccessToken</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">access_token</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">encryptedRefreshToken</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">refresh_token</span><span class="p">);</span>

  <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksToken</span><span class="p">.</span><span class="nx">upsert</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">},</span>
    <span class="na">create</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">organizationId</span><span class="p">,</span>
      <span class="na">accessToken</span><span class="p">:</span> <span class="nx">encryptedAccessToken</span><span class="p">,</span>
      <span class="na">refreshToken</span><span class="p">:</span> <span class="nx">encryptedRefreshToken</span><span class="p">,</span>
      <span class="nx">realmId</span><span class="p">,</span>
      <span class="na">expiresAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">expires_in</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
      <span class="na">isActive</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="na">update</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">accessToken</span><span class="p">:</span> <span class="nx">encryptedAccessToken</span><span class="p">,</span>
      <span class="na">refreshToken</span><span class="p">:</span> <span class="nx">encryptedRefreshToken</span><span class="p">,</span>
      <span class="na">expiresAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">expires_in</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
      <span class="na">isActive</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Token Refresh</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">refreshTokenIfNeeded</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">tokenRecord</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksToken</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tokenRecord</span> <span class="o">||</span> <span class="nx">tokenRecord</span><span class="p">.</span><span class="nx">expiresAt</span> <span class="o">&lt;</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">refreshedTokens</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">refreshAccessToken</span><span class="p">(</span><span class="nx">tokenRecord</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">storeQuickBooksTokens</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">refreshedTokens</span><span class="p">,</span> <span class="nx">tokenRecord</span><span class="p">.</span><span class="nx">realmId</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">refreshedTokens</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">access_token</span><span class="p">:</span> <span class="k">await</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">tokenRecord</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">),</span>
    <span class="na">realm_id</span><span class="p">:</span> <span class="nx">tokenRecord</span><span class="p">.</span><span class="nx">realmId</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="user-interface-integration"> <a href="#user-interface-integration" class="anchor-heading" aria-labelledby="user-interface-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User Interface Integration </h3> <ol> <li><strong>Connection Button Component</strong>: <div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/integrations/QuickBooksConnectButton.tsx</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Button</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/components/ui/button</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">QuickBooksConnectButton</span><span class="p">({</span> <span class="nx">organizationId</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">organizationId</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isConnecting</span><span class="p">,</span> <span class="nx">setIsConnecting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">handleConnect</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setIsConnecting</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/quickbooks/connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">organizationId</span> <span class="p">})</span>
      <span class="p">});</span>

      <span class="kd">const</span> <span class="p">{</span> <span class="nx">authUrl</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">authUrl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connection failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="nx">setIsConnecting</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">Button</span>
      <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">handleConnect</span><span class="si">}</span>
      <span class="na">disabled</span><span class="p">=</span><span class="si">{</span><span class="nx">isConnecting</span><span class="si">}</span>
      <span class="na">className</span><span class="p">=</span><span class="s">"bg-blue-600 hover:bg-blue-700"</span>
    <span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">isConnecting</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Connecting...</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Connect to QuickBooks</span><span class="dl">'</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nc">Button</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Connection Status Display</strong>: <div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/integrations/QuickBooksStatus.tsx</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">QuickBooksStatus</span><span class="p">({</span> <span class="nx">organizationId</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">organizationId</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">status</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useSWR</span><span class="p">(</span>
    <span class="s2">`/api/quickbooks/status/</span><span class="p">${</span><span class="nx">organizationId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="nx">fetcher</span>
  <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">status</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"space-y-4"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"flex items-center justify-between"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>QuickBooks Connection<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Badge</span> <span class="na">variant</span><span class="p">=</span><span class="si">{</span><span class="nx">status</span><span class="p">.</span><span class="nx">isConnected</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">secondary</span><span class="dl">'</span><span class="si">}</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="nx">status</span><span class="p">.</span><span class="nx">isConnected</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Connected</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Not Connected</span><span class="dl">'</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nc">Badge</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

      <span class="si">{</span><span class="nx">status</span><span class="p">.</span><span class="nx">isConnected</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"text-sm text-gray-600"</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Company: <span class="si">{</span><span class="nx">status</span><span class="p">.</span><span class="nx">companyName</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Last Sync: <span class="si">{</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">status</span><span class="p">.</span><span class="nx">lastSyncAt</span><span class="p">)</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Next Sync: <span class="si">{</span><span class="nx">formatDate</span><span class="p">(</span><span class="nx">status</span><span class="p">.</span><span class="nx">nextSyncAt</span><span class="p">)</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="data-synchronization"> <a href="#data-synchronization" class="anchor-heading" aria-labelledby="data-synchronization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Synchronization </h2> <h3 id="sync-service-implementation"> <a href="#sync-service-implementation" class="anchor-heading" aria-labelledby="sync-service-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sync Service Implementation </h3> <ol> <li><strong>Core Sync Service</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/services/quickbooks-sync.service.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">QuickBooksSyncService</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">qbApi</span><span class="p">:</span> <span class="nx">QuickBooksAPIService</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">qbApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QuickBooksAPIService</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">performSync</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">options</span><span class="p">:</span> <span class="nx">SyncOptions</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">syncRecord</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">createSyncRecord</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateSyncStatus</span><span class="p">(</span><span class="nx">syncRecord</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="dl">'</span><span class="s1">in_progress</span><span class="dl">'</span><span class="p">);</span>

      <span class="c1">// Sync in priority order</span>
      <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">allSettled</span><span class="p">([</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">syncCompanyInfo</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">syncChartOfAccounts</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">syncCustomers</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">syncItems</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">),</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">syncTransactions</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dateRange</span><span class="p">)</span>
      <span class="p">]);</span>

      <span class="kd">const</span> <span class="nx">summary</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">processSyncResults</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateSyncStatus</span><span class="p">(</span><span class="nx">syncRecord</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="dl">'</span><span class="s1">completed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">summary</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">summary</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateSyncStatus</span><span class="p">(</span><span class="nx">syncRecord</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="dl">'</span><span class="s1">failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">async</span> <span class="nx">syncCustomers</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">customers</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">qbApi</span><span class="p">.</span><span class="nx">getCustomers</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">processed</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">customer</span> <span class="k">of</span> <span class="nx">customers</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">clientData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapCustomerToClient</span><span class="p">(</span><span class="nx">customer</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">upsertClient</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">clientData</span><span class="p">);</span>
        <span class="nx">processed</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span><span class="p">,</span> <span class="na">clientId</span><span class="p">:</span> <span class="nx">client</span><span class="p">.</span><span class="nx">id</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">processed</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">processed</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">mapCustomerToClient</span><span class="p">(</span><span class="nx">customer</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">businessName</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
      <span class="na">legalName</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">CompanyName</span> <span class="o">||</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
      <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">PrimaryEmailAddr</span><span class="p">?.</span><span class="nx">Address</span><span class="p">,</span>
      <span class="na">primaryContactName</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">PrimaryPhone</span><span class="p">?.</span><span class="nx">FreeFormNumber</span><span class="p">,</span>
      <span class="na">businessAddress</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">formatAddress</span><span class="p">(</span><span class="nx">customer</span><span class="p">.</span><span class="nx">BillAddr</span><span class="p">),</span>
      <span class="na">quickbooksId</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span>
      <span class="na">financialData</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">balance</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Balance</span><span class="p">,</span>
        <span class="na">creditLimit</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">CreditLimit</span><span class="p">,</span>
        <span class="na">taxable</span><span class="p">:</span> <span class="nx">customer</span><span class="p">.</span><span class="nx">Taxable</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Incremental Sync</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">performIncrementalSync</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">lastSync</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getLastSyncTimestamp</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">changedSince</span> <span class="o">=</span> <span class="nx">lastSync</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// 30 days ago</span>

  <span class="kd">const</span> <span class="nx">entities</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Customer</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Item</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Account</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Invoice</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Payment</span><span class="dl">'</span><span class="p">];</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entity</span> <span class="k">of</span> <span class="nx">entities</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">changes</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">qbApi</span><span class="p">.</span><span class="nx">getChangedEntities</span><span class="p">(</span>
      <span class="nx">organizationId</span><span class="p">,</span>
      <span class="nx">entity</span><span class="p">,</span>
      <span class="nx">changedSince</span>
    <span class="p">);</span>

    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">processEntityChanges</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">entity</span><span class="p">,</span> <span class="nx">changes</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">await</span> <span class="nx">updateLastSyncTimestamp</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="data-mapping"> <a href="#data-mapping" class="anchor-heading" aria-labelledby="data-mapping"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Mapping </h3> <ol> <li><strong>Customer to Client Mapping</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CustomerMapping</span> <span class="p">{</span>
  <span class="nl">qbField</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">platformField</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">transform</span><span class="p">?:</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">customerMappings</span><span class="p">:</span> <span class="nx">CustomerMapping</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">qbField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">,</span> <span class="na">platformField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">businessName</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">qbField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CompanyName</span><span class="dl">'</span><span class="p">,</span> <span class="na">platformField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">legalName</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">qbField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">PrimaryEmailAddr.Address</span><span class="dl">'</span><span class="p">,</span> <span class="na">platformField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">primaryContactEmail</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">qbField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">PrimaryPhone.FreeFormNumber</span><span class="dl">'</span><span class="p">,</span> <span class="na">platformField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">primaryContactPhone</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">qbField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">BillAddr</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">platformField</span><span class="p">:</span> <span class="dl">'</span><span class="s1">businessAddress</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">transform</span><span class="p">:</span> <span class="p">(</span><span class="nx">addr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">formatAddress</span><span class="p">(</span><span class="nx">addr</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">];</span>
</code></pre></div> </div> </li> <li><strong>Chart of Accounts Mapping</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">accountMappings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="dl">'</span><span class="s1">Asset</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">assets</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Liability</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">liabilities</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Equity</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">equity</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Income</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">revenue</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Expense</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">expenses</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">Cost of Goods Sold</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cogs</span><span class="dl">'</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">mapQBAccountType</span><span class="p">(</span><span class="nx">qbType</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">accountMappings</span><span class="p">[</span><span class="nx">qbType</span><span class="p">]</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">other</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="sync-scheduling"> <a href="#sync-scheduling" class="anchor-heading" aria-labelledby="sync-scheduling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sync Scheduling </h3> <ol> <li><strong>Automated Sync Jobs</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/jobs/quickbooks-sync.job.ts</span>
<span class="k">import</span> <span class="nx">cron</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-cron</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Daily sync at 2 AM</span>
<span class="nx">cron</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="dl">'</span><span class="s1">0 2 * * *</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">organizations</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getOrganizationsWithQBIntegration</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">org</span> <span class="k">of</span> <span class="nx">organizations</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">performIncrementalSync</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Sync failed for organization </span><span class="p">${</span><span class="nx">org</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">:`</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">await</span> <span class="nx">notifyAdmins</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Hourly sync for high-priority organizations</span>
<span class="nx">cron</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="dl">'</span><span class="s1">0 * * * *</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">priorityOrgs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getPriorityOrganizations</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">org</span> <span class="k">of</span> <span class="nx">priorityOrgs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">performIncrementalSync</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div> </div> </li> <li><strong>Manual Sync Trigger</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/quickbooks/sync/route.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">POST</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">NextRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">organizationId</span><span class="p">,</span> <span class="nx">syncType</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">incremental</span><span class="dl">'</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">syncJob</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">queueSyncJob</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">syncType</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
      <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">syncId</span><span class="p">:</span> <span class="nx">syncJob</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="na">estimatedCompletion</span><span class="p">:</span> <span class="nx">syncJob</span><span class="p">.</span><span class="nx">estimatedCompletion</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Failed to start sync</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">500</span> <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="webhook-configuration"> <a href="#webhook-configuration" class="anchor-heading" aria-labelledby="webhook-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Webhook Configuration </h2> <h3 id="webhook-setup"> <a href="#webhook-setup" class="anchor-heading" aria-labelledby="webhook-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Webhook Setup </h3> <ol> <li><strong>Webhook Endpoint</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/webhooks/quickbooks/route.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NextRequest</span><span class="p">,</span> <span class="nx">NextResponse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">crypto</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">POST</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">NextRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">intuit-signature</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// Verify webhook signature</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">verifyWebhookSignature</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">signature</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid signature</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">401</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">webhookData</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">processWebhookEvents</span><span class="p">(</span><span class="nx">webhookData</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Webhook processing failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Processing failed</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">500</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">verifyWebhookSignature</span><span class="p">(</span><span class="nx">payload</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">signature</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">expectedSignature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">QUICKBOOKS_WEBHOOK_VERIFIER_TOKEN</span><span class="o">!</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">signature</span> <span class="o">===</span> <span class="nx">expectedSignature</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Event Processing</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">processWebhookEvents</span><span class="p">(</span><span class="nx">webhookData</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">eventNotifications</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">webhookData</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">notification</span> <span class="k">of</span> <span class="nx">eventNotifications</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">dataChangeEvent</span> <span class="k">of</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">dataChangeEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">processDataChangeEvent</span><span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">realmId</span><span class="p">,</span> <span class="nx">dataChangeEvent</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">processDataChangeEvent</span><span class="p">(</span><span class="nx">realmId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">event</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">operation</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">lastUpdated</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>

  <span class="c1">// Store webhook event for processing</span>
  <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksWebhookEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">eventId</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">realmId</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">lastUpdated</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">eventType</span><span class="p">:</span> <span class="nx">operation</span><span class="p">,</span>
      <span class="na">entityName</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>
      <span class="na">entityId</span><span class="p">:</span> <span class="nx">id</span><span class="p">,</span>
      <span class="nx">realmId</span><span class="p">,</span>
      <span class="na">eventTime</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">lastUpdated</span><span class="p">),</span>
      <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">payload</span><span class="p">:</span> <span class="nx">event</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Queue for async processing</span>
  <span class="k">await</span> <span class="nx">queueWebhookProcessing</span><span class="p">(</span><span class="nx">realmId</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="webhook-processing"> <a href="#webhook-processing" class="anchor-heading" aria-labelledby="webhook-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Webhook Processing </h3> <ol> <li><strong>Async Event Processing</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">processWebhookEvent</span><span class="p">(</span><span class="nx">eventId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksWebhookEvent</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">eventId</span> <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">pending</span><span class="dl">'</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksWebhookEvent</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">eventId</span> <span class="p">},</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">processing</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">entityName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">Customer</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">await</span> <span class="nx">handleCustomerChange</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">Invoice</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">await</span> <span class="nx">handleInvoiceChange</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">Payment</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">await</span> <span class="nx">handlePaymentChange</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Unhandled entity type: </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">entityName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksWebhookEvent</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">eventId</span> <span class="p">},</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">processed</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">processedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksWebhookEvent</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">eventId</span> <span class="p">},</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">failed</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">errorMessage</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
        <span class="na">retryCount</span><span class="p">:</span> <span class="p">{</span> <span class="na">increment</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Entity-Specific Handlers</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">handleCustomerChange</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">QuickBooksWebhookEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">organization</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">findOrganizationByRealmId</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">realmId</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">organization</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">eventType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">CREATE</span><span class="dl">'</span><span class="p">:</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">UPDATE</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">await</span> <span class="nx">syncSpecificCustomer</span><span class="p">(</span><span class="nx">organization</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">entityId</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">await</span> <span class="nx">handleCustomerDeletion</span><span class="p">(</span><span class="nx">organization</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">entityId</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">syncSpecificCustomer</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">customerId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">customer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">qbApi</span><span class="p">.</span><span class="nx">getCustomer</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">customerId</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">clientData</span> <span class="o">=</span> <span class="nx">mapCustomerToClient</span><span class="p">(</span><span class="nx">customer</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">upsertClient</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">clientData</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="testing-integration"> <a href="#testing-integration" class="anchor-heading" aria-labelledby="testing-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing Integration </h2> <h3 id="development-testing"> <a href="#development-testing" class="anchor-heading" aria-labelledby="development-testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Testing </h3> <ol> <li><strong>Sandbox Environment Setup</strong>: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use QuickBooks Sandbox credentials</span>
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span>sandbox
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span>your_sandbox_client_id
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span>your_sandbox_client_secret
<span class="nv">QUICKBOOKS_DISCOVERY_DOCUMENT</span><span class="o">=</span>https://developer.api.intuit.com/.well-known/connect_uri_sandbox
</code></pre></div> </div> </li> <li><strong>Create Test Company</strong>: <ul> <li>Log into QuickBooks Sandbox</li> <li>Create test company with sample data</li> <li>Add various entity types (customers, items, invoices)</li> <li>Test different scenarios (active/inactive entities, various data types)</li> </ul> </li> </ol> <h3 id="integration-tests"> <a href="#integration-tests" class="anchor-heading" aria-labelledby="integration-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Integration Tests </h3> <ol> <li><strong>OAuth Flow Test</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tests/integration/quickbooks-oauth.test.ts</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">QuickBooks OAuth Integration</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should generate valid auth URL</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">authUrl</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateAuthUrl</span><span class="p">({</span>
      <span class="na">organizationId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-org</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.intuit.quickbooks.accounting</span><span class="dl">'</span>
    <span class="p">});</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">authUrl</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://appcenter.intuit.com/connect/oauth2</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">authUrl</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">'</span><span class="s1">client_id=</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">authUrl</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">'</span><span class="s1">scope=com.intuit.quickbooks.accounting</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should handle OAuth callback correctly</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">mockCallback</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">code</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-auth-code</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">state</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-state</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">realmId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test-realm-id</span><span class="dl">'</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handleOAuthCallback</span><span class="p">(</span><span class="nx">mockCallback</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div> </div> </li> <li><strong>Sync Test</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tests/integration/quickbooks-sync.test.ts</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">QuickBooks Data Sync</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">setupTestDatabase</span><span class="p">();</span>
    <span class="k">await</span> <span class="nx">createTestOrganization</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should sync customers successfully</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">syncResult</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">syncCustomers</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-org-id</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">syncResult</span><span class="p">.</span><span class="nx">recordsProcessed</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">syncResult</span><span class="p">.</span><span class="nx">recordsSuccess</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">syncResult</span><span class="p">.</span><span class="nx">recordsProcessed</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">clients</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getClients</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-org-id</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">clients</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should handle sync errors gracefully</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Mock API error</span>
    <span class="nx">jest</span><span class="p">.</span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">qbApi</span><span class="p">,</span> <span class="dl">'</span><span class="s1">getCustomers</span><span class="dl">'</span><span class="p">).</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">API Error</span><span class="dl">'</span><span class="p">));</span>

    <span class="kd">const</span> <span class="nx">syncResult</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">syncCustomers</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-org-id</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">syncResult</span><span class="p">.</span><span class="nx">recordsFailed</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div> </div> </li> </ol> <h3 id="end-to-end-testing"> <a href="#end-to-end-testing" class="anchor-heading" aria-labelledby="end-to-end-testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> End-to-End Testing </h3> <ol> <li><strong>Complete Flow Test</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tests/e2e/quickbooks-integration.spec.ts</span>
<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">complete QuickBooks integration flow</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">page</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Login to platform</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=email]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">admin@testfirm.com</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=password]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">password123</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=login-button]</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Navigate to integrations</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">'</span><span class="s1">/settings/integrations</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Start QuickBooks connection</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=connect-quickbooks]</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Handle QuickBooks OAuth (in new tab)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">qbPage</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">waitForEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">popup</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=connect-quickbooks]</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">]);</span>

  <span class="c1">// Complete OAuth in QuickBooks</span>
  <span class="k">await</span> <span class="nx">qbPage</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sandbox-user@example.com</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">qbPage</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">#password</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sandbox-password</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">qbPage</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">#signin</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">qbPage</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">#authorizeBtn</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Verify connection back in platform</span>
  <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">waitForSelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=qb-connected]</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">textContent</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid=qb-status]</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div> </div> </li> </ol> <h3 id="load-testing"> <a href="#load-testing" class="anchor-heading" aria-labelledby="load-testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Load Testing </h3> <ol> <li><strong>Sync Performance Test</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tests/load/quickbooks-sync.load.test.ts</span>
<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">QuickBooks Sync Performance</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">should handle large dataset sync</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

    <span class="c1">// Sync large test dataset (1000+ records)</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">performFullSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">test-org-id</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">duration</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">throughput</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">recordsProcessed</span> <span class="o">/</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">throughput</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// Records per second</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">recordsSuccess</span> <span class="o">/</span> <span class="nx">result</span><span class="p">.</span><span class="nx">recordsProcessed</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">0.95</span><span class="p">);</span> <span class="c1">// 95% success rate</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="production-deployment"> <a href="#production-deployment" class="anchor-heading" aria-labelledby="production-deployment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Production Deployment </h2> <h3 id="pre-production-checklist"> <a href="#pre-production-checklist" class="anchor-heading" aria-labelledby="pre-production-checklist"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pre-Production Checklist </h3> <ol> <li><strong>App Review Completion</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Intuit app review approved</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Production credentials obtained</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Privacy policy and terms of service published</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Support documentation completed</li> </ul> </li> <li><strong>Security Review</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />SSL certificates installed and verified</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Webhook endpoints secured</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Token encryption implemented</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Access logging enabled</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Rate limiting configured</li> </ul> </li> <li><strong>Performance Testing</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Load testing completed</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Sync performance benchmarks established</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Error handling tested</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Webhook processing tested</li> </ul> </li> </ol> <h3 id="production-configuration"> <a href="#production-configuration" class="anchor-heading" aria-labelledby="production-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Production Configuration </h3> <ol> <li><strong>Environment Variables</strong>: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Production environment</span>
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span>production
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span>your_production_client_id
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span>your_production_client_secret
<span class="nv">QUICKBOOKS_DISCOVERY_DOCUMENT</span><span class="o">=</span>https://developer.api.intuit.com/.well-known/connect_uri
<span class="nv">QUICKBOOKS_WEBHOOK_VERIFIER_TOKEN</span><span class="o">=</span>your_production_webhook_token
</code></pre></div> </div> </li> <li><strong>Rate Limiting</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">rateLimits</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">production</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">requestsPerMinute</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span> <span class="c1">// QB limit is 500/minute</span>
    <span class="na">burstLimit</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="na">retryAfter</span><span class="p">:</span> <span class="mi">60000</span>
  <span class="p">},</span>
  <span class="na">sandbox</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">requestsPerMinute</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="na">burstLimit</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="na">retryAfter</span><span class="p">:</span> <span class="mi">30000</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div> </div> </li> </ol> <h3 id="monitoring-setup"> <a href="#monitoring-setup" class="anchor-heading" aria-labelledby="monitoring-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring Setup </h3> <ol> <li><strong>Sync Monitoring</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Monitor sync performance and errors</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">monitorSyncHealth</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">last24Hours</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">syncStats</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksSync</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">startedAt</span><span class="p">:</span> <span class="p">{</span> <span class="na">gte</span><span class="p">:</span> <span class="nx">last24Hours</span> <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">_count</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">_avg</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">recordsProcessed</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">recordsSuccess</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">errorRate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nx">syncStats</span><span class="p">.</span><span class="nx">_avg</span><span class="p">.</span><span class="nx">recordsSuccess</span> <span class="o">/</span> <span class="nx">syncStats</span><span class="p">.</span><span class="nx">_avg</span><span class="p">.</span><span class="nx">recordsProcessed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">errorRate</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 5% error threshold</span>
    <span class="k">await</span> <span class="nx">sendAlert</span><span class="p">(</span><span class="dl">'</span><span class="s1">High QuickBooks sync error rate</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">errorRate</span><span class="p">,</span> <span class="na">stats</span><span class="p">:</span> <span class="nx">syncStats</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>API Health Monitoring</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Regular health checks</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://quickbooks.api.intuit.com/health</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">sendAlert</span><span class="p">(</span><span class="dl">'</span><span class="s1">QuickBooks API health check failed</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">sendAlert</span><span class="p">(</span><span class="dl">'</span><span class="s1">QuickBooks API unreachable</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// Every 5 minutes</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="troubleshooting"> <a href="#troubleshooting" class="anchor-heading" aria-labelledby="troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting </h2> <h3 id="common-issues"> <a href="#common-issues" class="anchor-heading" aria-labelledby="common-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Issues </h3> <ol> <li><strong>Authentication Errors</strong>: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: "invalid_grant"
Solution: Token has expired. Implement automatic token refresh.

Error: "unauthorized_client"
Solution: Check client ID and secret are correct for environment.

Error: "invalid_scope"
Solution: Ensure requested scopes match app configuration.
</code></pre></div> </div> </li> <li><strong>API Errors</strong>: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: Rate limit exceeded (429)
Solution: Implement exponential backoff and retry logic.

Error: Invalid company ID (403)
Solution: Verify realmId matches connected company.

Error: Entity not found (404)
Solution: Handle deleted entities in QuickBooks.
</code></pre></div> </div> </li> <li><strong>Sync Issues</strong>: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: Partial sync completion
Solution: Check for data validation errors and handle individually.

Error: Webhook delivery failures
Solution: Verify webhook URL accessibility and signature verification.

Error: Data inconsistencies
Solution: Implement conflict resolution and manual review process.
</code></pre></div> </div> </li> </ol> <h3 id="debug-tools"> <a href="#debug-tools" class="anchor-heading" aria-labelledby="debug-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debug Tools </h3> <ol> <li><strong>Sync Status Dashboard</strong>: <div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/admin/QuickBooksSyncDashboard.tsx</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">QuickBooksSyncDashboard</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">syncStats</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useSWR</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/admin/quickbooks/sync-stats</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fetcher</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"space-y-6"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"grid grid-cols-4 gap-4"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">MetricCard</span> <span class="na">title</span><span class="p">=</span><span class="s">"Active Connections"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">activeConnections</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">MetricCard</span> <span class="na">title</span><span class="p">=</span><span class="s">"Daily Syncs"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">dailySyncs</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">MetricCard</span> <span class="na">title</span><span class="p">=</span><span class="s">"Success Rate"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">successRate</span><span class="p">}</span><span class="s2">%`</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">MetricCard</span> <span class="na">title</span><span class="p">=</span><span class="s">"Avg Sync Time"</span> <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">avgSyncTime</span><span class="p">}</span><span class="s2">s`</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nc">SyncHistory</span> <span class="na">syncs</span><span class="p">=</span><span class="si">{</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">recentSyncs</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">ErrorLog</span> <span class="na">errors</span><span class="p">=</span><span class="si">{</span><span class="nx">syncStats</span><span class="p">?.</span><span class="nx">recentErrors</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>API Test Tool</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tools/quickbooks-api-tester.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">QuickBooksAPITester</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nx">testConnection</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">companyInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">qbApi</span><span class="p">.</span><span class="nx">getCompanyInfo</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">companyInfo</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">testEntitySync</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityType</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">entities</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">qbApi</span><span class="p">.</span><span class="nx">getEntities</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">entityType</span><span class="p">,</span> <span class="p">{</span> <span class="na">limit</span><span class="p">:</span> <span class="mi">5</span> <span class="p">});</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="na">sample</span><span class="p">:</span> <span class="nx">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol> <h3 id="error-recovery"> <a href="#error-recovery" class="anchor-heading" aria-labelledby="error-recovery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Recovery </h3> <ol> <li><strong>Automatic Retry Logic</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">withRetry</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">operation</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">maxRetries</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nx">backoffMs</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">attempt</span> <span class="o">&lt;=</span> <span class="nx">maxRetries</span><span class="p">;</span> <span class="nx">attempt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="nx">operation</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">attempt</span> <span class="o">===</span> <span class="nx">maxRetries</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">shouldRetry</span> <span class="o">=</span> <span class="nx">isRetryableError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldRetry</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">delay</span> <span class="o">=</span> <span class="nx">backoffMs</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">attempt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">delay</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">isRetryableError</span><span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">retryableCodes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">];</span>
  <span class="k">return</span> <span class="nx">retryableCodes</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="o">||</span> <span class="nx">error</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">ECONNRESET</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Data Recovery Procedures</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">recoverFailedSync</span><span class="p">(</span><span class="nx">syncId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">sync</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">quickBooksSync</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">syncId</span> <span class="p">}</span> <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sync</span> <span class="o">||</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">failed</span><span class="dl">'</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// Identify what failed</span>
  <span class="kd">const</span> <span class="nx">failedEntities</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">identifyFailedEntities</span><span class="p">(</span><span class="nx">sync</span><span class="p">);</span>

  <span class="c1">// Retry failed entities only</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entity</span> <span class="k">of</span> <span class="nx">failedEntities</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">syncSpecificEntity</span><span class="p">(</span><span class="nx">sync</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="kd">type</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">await</span> <span class="nx">markEntityAsRecovered</span><span class="p">(</span><span class="nx">syncId</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">logRecoveryFailure</span><span class="p">(</span><span class="nx">syncId</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="best-practices"> <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices </h2> <h3 id="security-best-practices"> <a href="#security-best-practices" class="anchor-heading" aria-labelledby="security-best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Best Practices </h3> <ol> <li><strong>Token Security</strong>: <ul> <li>Always encrypt tokens at rest</li> <li>Use environment-specific encryption keys</li> <li>Implement token rotation policies</li> <li>Monitor for token exposure</li> </ul> </li> <li><strong>API Security</strong>: <ul> <li>Validate all webhook signatures</li> <li>Use HTTPS for all communications</li> <li>Implement rate limiting and DDoS protection</li> <li>Log all API interactions for audit</li> </ul> </li> <li><strong>Data Privacy</strong>: <ul> <li>Minimize data storage (sync only required fields)</li> <li>Implement data retention policies</li> <li>Provide data export capabilities</li> <li>Follow GDPR and other privacy regulations</li> </ul> </li> </ol> <h3 id="performance-best-practices"> <a href="#performance-best-practices" class="anchor-heading" aria-labelledby="performance-best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Performance Best Practices </h3> <ol> <li><strong>Sync Optimization</strong>: <ul> <li>Use incremental syncs when possible</li> <li>Batch API requests efficiently</li> <li>Implement parallel processing for independent entities</li> <li>Cache frequently accessed data</li> </ul> </li> <li><strong>Error Handling</strong>: <ul> <li>Implement comprehensive error logging</li> <li>Use exponential backoff for retries</li> <li>Handle partial failures gracefully</li> <li>Provide clear error messages to users</li> </ul> </li> <li><strong>Monitoring</strong>: <ul> <li>Set up alerts for sync failures</li> <li>Monitor API response times</li> <li>Track data consistency</li> <li>Monitor webhook delivery success</li> </ul> </li> </ol> <h3 id="data-management"> <a href="#data-management" class="anchor-heading" aria-labelledby="data-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Management </h3> <ol> <li><strong>Conflict Resolution</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">enum</span> <span class="nx">ConflictResolution</span> <span class="p">{</span>
  <span class="nx">QUICKBOOKS_WINS</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">quickbooks_wins</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">PLATFORM_WINS</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">platform_wins</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">MANUAL_REVIEW</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">manual_review</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">MERGE_DATA</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">merge_data</span><span class="dl">'</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">resolveDataConflict</span><span class="p">(</span>
  <span class="nx">platformData</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span>
  <span class="nx">qbData</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span>
  <span class="nx">strategy</span><span class="p">:</span> <span class="nx">ConflictResolution</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">strategy</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">ConflictResolution</span><span class="p">.</span><span class="nx">QUICKBOOKS_WINS</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">qbData</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">ConflictResolution</span><span class="p">.</span><span class="nx">PLATFORM_WINS</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">platformData</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">ConflictResolution</span><span class="p">.</span><span class="nx">MANUAL_REVIEW</span><span class="p">:</span>
      <span class="k">await</span> <span class="nx">queueForManualReview</span><span class="p">(</span><span class="nx">platformData</span><span class="p">,</span> <span class="nx">qbData</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">ConflictResolution</span><span class="p">.</span><span class="nx">MERGE_DATA</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">mergeDataIntelligently</span><span class="p">(</span><span class="nx">platformData</span><span class="p">,</span> <span class="nx">qbData</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li><strong>Data Validation</strong>: <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">dataValidators</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">customer</span><span class="p">:</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Customer name is required</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Balance</span> <span class="o">&amp;&amp;</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid balance format</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="na">invoice</span><span class="p">:</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">CustomerRef</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Customer reference required</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">Line</span> <span class="o">||</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Line</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invoice must have line items</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div> </div> </li> </ol><hr /> <h2 id="support-and-resources"> <a href="#support-and-resources" class="anchor-heading" aria-labelledby="support-and-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Support and Resources </h2> <h3 id="intuit-developer-resources"> <a href="#intuit-developer-resources" class="anchor-heading" aria-labelledby="intuit-developer-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Intuit Developer Resources </h3> <ul> <li><strong>Developer Documentation</strong>: https://developer.intuit.com/app/developer/qbo/docs</li> <li><strong>API Explorer</strong>: https://developer.intuit.com/app/developer/qbo/docs/api/accounting/most-commonly-used/customer</li> <li><strong>Community Forums</strong>: https://developer.intuit.com/community</li> <li><strong>Support Portal</strong>: https://help.developer.intuit.com/</li> </ul> <h3 id="platform-support"> <a href="#platform-support" class="anchor-heading" aria-labelledby="platform-support"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Platform Support </h3> <ul> <li><strong>Technical Documentation</strong>: Link to your platform’s tech docs</li> <li><strong>API Reference</strong>: Link to your API documentation</li> <li><strong>Support Portal</strong>: Link to your support system</li> <li><strong>Community Forum</strong>: Link to user community</li> </ul> <h3 id="common-resources"> <a href="#common-resources" class="anchor-heading" aria-labelledby="common-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Resources </h3> <ol> <li><strong>Sample Code Repository</strong>: <ul> <li>OAuth implementation examples</li> <li>Sync service templates</li> <li>Webhook handlers</li> <li>Error handling patterns</li> </ul> </li> <li><strong>Testing Tools</strong>: <ul> <li>API response validators</li> <li>Sync performance analyzers</li> <li>Data consistency checkers</li> <li>Load testing scripts</li> </ul> </li> <li><strong>Monitoring Templates</strong>: <ul> <li>Dashboard configurations</li> <li>Alert rule templates</li> <li>Performance metrics</li> <li>Health check scripts</li> </ul> </li> </ol> <h3 id="emergency-contacts"> <a href="#emergency-contacts" class="anchor-heading" aria-labelledby="emergency-contacts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Emergency Contacts </h3> <ul> <li><strong>Intuit Developer Support</strong>: Available through developer portal</li> <li><strong>Platform Technical Support</strong>: Your internal support team</li> <li><strong>On-Call Engineering</strong>: For critical production issues</li> <li><strong>Account Management</strong>: For billing and account issues</li> </ul><hr /> <p><em>This QuickBooks integration setup guide provides comprehensive instructions for implementing and maintaining the QuickBooks integration. Always test thoroughly in sandbox environments before deploying to production, and maintain proper error handling and monitoring for production deployments.</em></p> </main> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Built by the AdvisorOS team | Updated {{ site.time | date: '%B %d, %Y' }}</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
