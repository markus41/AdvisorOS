<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/AdvisorOS/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/AdvisorOS/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(17)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(17) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(17) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(17) > ul.nav-list { display: block; } </style> <script src="/AdvisorOS/assets/js/vendor/lunr.min.js"></script> <script src="/AdvisorOS/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Developer Environment Setup | AdvisorOS Documentation</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Developer Environment Setup" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Implementation, adoption, and operations playbook for AdvisorOS." /> <meta property="og:description" content="Implementation, adoption, and operations playbook for AdvisorOS." /> <link rel="canonical" href="https://markus41.github.io/AdvisorOS/DEVELOPER_SETUP_ENHANCED.html" /> <meta property="og:url" content="https://markus41.github.io/AdvisorOS/DEVELOPER_SETUP_ENHANCED.html" /> <meta property="og:site_name" content="AdvisorOS Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Developer Environment Setup" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Implementation, adoption, and operations playbook for AdvisorOS.","headline":"Developer Environment Setup","url":"https://markus41.github.io/AdvisorOS/DEVELOPER_SETUP_ENHANCED.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/AdvisorOS/" class="site-title lh-tight"> AdvisorOS Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/AdvisorOS/wiki/" class="nav-list-link">AdvisorOS Wiki</a></li><li class="nav-list-item"><a href="/AdvisorOS/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/AdvisorOS/business/" class="nav-list-link">Business Overview</a></li><li class="nav-list-item"><a href="/AdvisorOS/FEATURES.html" class="nav-list-link">Product Capabilities</a></li><li class="nav-list-item"><a href="/AdvisorOS/strategic/" class="nav-list-link">Strategic Documentation</a></li><li class="nav-list-item"><a href="/AdvisorOS/QUICK_START.html" class="nav-list-link">Executive Quick Start</a></li><li class="nav-list-item"><a href="/AdvisorOS/README.html" class="nav-list-link">Documentation Home</a></li><li class="nav-list-item"><a href="/AdvisorOS/technical/" class="nav-list-link">Technical Hub</a></li><li class="nav-list-item"><a href="/AdvisorOS/integrations/" class="nav-list-link">Integrations Hub</a></li><li class="nav-list-item"><a href="/AdvisorOS/security/" class="nav-list-link">Security & Compliance</a></li><li class="nav-list-item"><a href="/AdvisorOS/ARCHITECTURE.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item"><a href="/AdvisorOS/API_REFERENCE.html" class="nav-list-link">API Reference</a></li><li class="nav-list-item"><a href="/AdvisorOS/USER_GUIDE_COMPREHENSIVE.html" class="nav-list-link">User Guide (Comprehensive)</a></li><li class="nav-list-item"><a href="/AdvisorOS/README_USER.html" class="nav-list-link">Implementation Runbook</a></li><li class="nav-list-item"><a href="/AdvisorOS/CLIENT_PORTAL_GUIDE.html" class="nav-list-link">Client Portal Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/DATABASE.html" class="nav-list-link">Database Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/DEVELOPER_SETUP_ENHANCED.html" class="nav-list-link">Developer Environment Setup</a></li><li class="nav-list-item"><a href="/AdvisorOS/DEPLOYMENT.html" class="nav-list-link">Deployment Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/ADMINISTRATOR_GUIDE.html" class="nav-list-link">Administrator Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/INTEGRATION_GUIDES.html" class="nav-list-link">Integration Guides</a></li><li class="nav-list-item"><a href="/AdvisorOS/QUICKBOOKS_SETUP.html" class="nav-list-link">QuickBooks Setup</a></li><li class="nav-list-item"><a href="/AdvisorOS/README_DEV.html" class="nav-list-link">Developer Setup</a></li><li class="nav-list-item"><a href="/AdvisorOS/TROUBLESHOOTING.html" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operations Command Center category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/AdvisorOS/operations/" class="nav-list-link">Operations Command Center</a><ul class="nav-list"><li class="nav-list-item"><a href="/AdvisorOS/operations/incident-response.html" class="nav-list-link">Incident Response Playbook</a></li><li class="nav-list-item"><a href="/AdvisorOS/operations/RUNBOOK.html" class="nav-list-link">Operations Runbook</a></li><li class="nav-list-item"><a href="/AdvisorOS/operations/DEPLOYMENT_GUIDE.html" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/AdvisorOS/compliance/README.html" class="nav-list-link">Compliance Overview</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/001-multi-tenant-data-isolation.html" class="nav-list-link">ADR-001: Multi-Tenant Data Isolation Strategy</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/002-prisma-schema-design.html" class="nav-list-link">ADR-002: Prisma Schema Design and Relationships</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/003-nextjs-app-router-api-design.html" class="nav-list-link">ADR-003: Next.js App Router Structure and API Design</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/004-azure-infrastructure-scaling.html" class="nav-list-link">ADR-004: Azure Infrastructure Choices and Scaling Strategy</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/005-security-architecture-compliance.html" class="nav-list-link">ADR-005: Security Architecture and Compliance Framework</a></li><li class="nav-list-item"><a href="/AdvisorOS/api/" class="nav-list-link">AdvisorOS API Documentation</a></li><li class="nav-list-item"><a href="/AdvisorOS/admin/" class="nav-list-link">AdvisorOS Administrator Documentation</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/ARCHITECTURE_AUDIT_SUMMARY.html" class="nav-list-link">AdvisorOS Architecture Audit Summary</a></li><li class="nav-list-item"><a href="/AdvisorOS/COST_OPTIMIZATION_STRATEGY.html" class="nav-list-link">AdvisorOS Cost Optimization Strategy</a></li><li class="nav-list-item"><a href="/AdvisorOS/developer/" class="nav-list-link">AdvisorOS Developer Documentation</a></li><li class="nav-list-item"><a href="/AdvisorOS/FAQ_TROUBLESHOOTING.html" class="nav-list-link">AdvisorOS FAQ &amp; Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/PRODUCTION_READINESS_CHECKLIST.html" class="nav-list-link">AdvisorOS Production Readiness Checklist</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/TECHNICAL_DEBT_ANALYSIS.html" class="nav-list-link">AdvisorOS Technical Debt Analysis and Improvement Roadmap</a></li><li class="nav-list-item"><a href="/AdvisorOS/templates/TECHNICAL_DOC_TEMPLATE.html" class="nav-list-link">AdvisorOS Technical Doc Template</a></li><li class="nav-list-item"><a href="/AdvisorOS/user-guide/" class="nav-list-link">AdvisorOS User Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/architecture/adrs/" class="nav-list-link">Architectural Decision Records (ADRs)</a></li><li class="nav-list-item"><a href="/AdvisorOS/admin/infrastructure/azure-deployment.html" class="nav-list-link">Azure Deployment Guide for AdvisorOS</a></li><li class="nav-list-item"><a href="/AdvisorOS/api-specs/endpoints.html" class="nav-list-link">CPA Platform API Specifications</a></li><li class="nav-list-item"><a href="/AdvisorOS/design-system/components.html" class="nav-list-link">CPA Platform Design System - Components</a></li><li class="nav-list-item"><a href="/AdvisorOS/api/routes/client.html" class="nav-list-link">Client Management API</a></li><li class="nav-list-item"><a href="/AdvisorOS/user-guide/cpa-firms/client-management.html" class="nav-list-link">Client Management Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/user-guide/clients/client-portal-guide.html" class="nav-list-link">Client Portal User Guide</a></li><li class="nav-list-item"><a href="/AdvisorOS/user-guide/cpa-firms/getting-started.html" class="nav-list-link">Getting Started with AdvisorOS</a></li><li class="nav-list-item"><a href="/AdvisorOS/compliance/soc2/overview.html" class="nav-list-link">SOC 2 Type II Compliance Overview</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/markus41/AdvisorOS/blob/main/ADVISOROS_COMPREHENSIVE_ENHANCEMENT_PORTFOLIO.md" class="nav-list-link external" > Product Overview (PDF) <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AdvisorOS Documentation" aria-label="Search AdvisorOS Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/markus41/AdvisorOS" class="site-button" > AdvisorOS on GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <blockquote> <p>[!NOTE] <strong>Navigation:</strong> <a href="/AdvisorOS/">Documentation Portal</a> › Developer Environment Setup<br /> Adjacent tracks: <a href="/AdvisorOS/ARCHITECTURE.html">Architecture Deep Dive</a> · <a href="/AdvisorOS/FEATURES.html">Product Capabilities</a> · <a href="/AdvisorOS/operations/">Operations Command Center</a></p> </blockquote> <h1 id="advisoros-developer-setup--architecture-guide"> <a href="#advisoros-developer-setup--architecture-guide" class="anchor-heading" aria-labelledby="advisoros-developer-setup--architecture-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AdvisorOS Developer Setup &amp; Architecture Guide </h1> <h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents </h2> <ol> <li><a href="#development-environment-setup">Development Environment Setup</a></li> <li><a href="#project-architecture-overview">Project Architecture Overview</a></li> <li><a href="#database-architecture">Database Architecture</a></li> <li><a href="#api-architecture">API Architecture</a></li> <li><a href="#frontend-architecture">Frontend Architecture</a></li> <li><a href="#development-workflow">Development Workflow</a></li> <li><a href="#testing-strategy">Testing Strategy</a></li> <li><a href="#debugging-and-monitoring">Debugging and Monitoring</a></li> <li><a href="#performance-optimization">Performance Optimization</a></li> <li><a href="#security-best-practices">Security Best Practices</a></li> <li><a href="#deployment-process">Deployment Process</a></li> <li><a href="#contributing-guidelines">Contributing Guidelines</a></li> </ol><hr /> <h2 id="development-environment-setup"> <a href="#development-environment-setup" class="anchor-heading" aria-labelledby="development-environment-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Environment Setup </h2> <h3 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h3> <h4 id="required-software"> <a href="#required-software" class="anchor-heading" aria-labelledby="required-software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Required Software </h4> <ul> <li><strong>Node.js</strong>: Version 18.17.0 or higher</li> <li><strong>npm</strong>: Version 9.0.0 or higher (or yarn/pnpm)</li> <li><strong>PostgreSQL</strong>: Version 14 or higher</li> <li><strong>Git</strong>: Latest version</li> <li><strong>Docker</strong>: Optional but recommended for containerized development</li> </ul> <h4 id="recommended-tools"> <a href="#recommended-tools" class="anchor-heading" aria-labelledby="recommended-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommended Tools </h4> <ul> <li><strong>VS Code</strong>: With recommended extensions</li> <li><strong>Postman</strong>: For API testing</li> <li><strong>pgAdmin</strong>: PostgreSQL administration</li> <li><strong>Prisma Studio</strong>: Database visualization</li> <li><strong>Redis</strong>: For caching and sessions (optional in development)</li> </ul> <h3 id="initial-setup"> <a href="#initial-setup" class="anchor-heading" aria-labelledby="initial-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initial Setup </h3> <h4 id="1-clone-and-install"> <a href="#1-clone-and-install" class="anchor-heading" aria-labelledby="1-clone-and-install"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Clone and Install </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the repository</span>
git clone https://github.com/your-org/advisoros.git
<span class="nb">cd </span>advisoros

<span class="c"># Install dependencies</span>
npm <span class="nb">install</span>

<span class="c"># Install Turbo globally (optional but recommended)</span>
npm <span class="nb">install</span> <span class="nt">-g</span> turbo
</code></pre></div></div> <h4 id="2-environment-configuration"> <a href="#2-environment-configuration" class="anchor-heading" aria-labelledby="2-environment-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Environment Configuration </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Copy environment template</span>
<span class="nb">cp</span> .env.example .env.local

<span class="c"># Configure environment variables</span>
nano .env.local
</code></pre></div></div> <h4 id="3-required-environment-variables"> <a href="#3-required-environment-variables" class="anchor-heading" aria-labelledby="3-required-environment-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Required Environment Variables </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Database</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span><span class="s2">"postgresql://postgres:password@localhost:5432/advisoros_dev"</span>

<span class="c"># NextAuth.js</span>
<span class="nv">NEXTAUTH_SECRET</span><span class="o">=</span><span class="s2">"your-development-secret-key"</span>
<span class="nv">NEXTAUTH_URL</span><span class="o">=</span><span class="s2">"http://localhost:3000"</span>

<span class="c"># External Services (Development/Sandbox)</span>
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span><span class="s2">"your-sandbox-qb-client-id"</span>
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span><span class="s2">"your-sandbox-qb-client-secret"</span>
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span><span class="s2">"sandbox"</span>

<span class="nv">STRIPE_SECRET_KEY</span><span class="o">=</span><span class="s2">"sk_test_your_stripe_test_key"</span>
<span class="nv">STRIPE_PUBLISHABLE_KEY</span><span class="o">=</span><span class="s2">"pk_test_your_stripe_test_key"</span>

<span class="nv">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">"your-openai-api-key"</span>

<span class="c"># Azure Storage (Development)</span>
<span class="nv">AZURE_STORAGE_CONNECTION_STRING</span><span class="o">=</span><span class="s2">"UseDevelopmentStorage=true"</span>

<span class="c"># Optional Development Tools</span>
<span class="nv">REDIS_URL</span><span class="o">=</span><span class="s2">"redis://localhost:6379"</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span><span class="s2">"debug"</span>
</code></pre></div></div> <h4 id="4-database-setup"> <a href="#4-database-setup" class="anchor-heading" aria-labelledby="4-database-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Database Setup </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start PostgreSQL (if using Docker)</span>
docker run <span class="nt">--name</span> advisoros-postgres <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>password <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">POSTGRES_DB</span><span class="o">=</span>advisoros_dev <span class="se">\</span>
  <span class="nt">-p</span> 5432:5432 <span class="se">\</span>
  <span class="nt">-d</span> postgres:14

<span class="c"># Or install locally and create database</span>
createdb advisoros_dev

<span class="c"># Run migrations</span>
npm run db:push

<span class="c"># Seed development data</span>
npm run db:seed
</code></pre></div></div> <h4 id="5-start-development-server"> <a href="#5-start-development-server" class="anchor-heading" aria-labelledby="5-start-development-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Start Development Server </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start all services</span>
npm run dev

<span class="c"># Or start specific packages</span>
npm run dev <span class="nt">--filter</span><span class="o">=</span>web
npm run dev <span class="nt">--filter</span><span class="o">=</span>@advisoros/database
</code></pre></div></div> <h3 id="vs-code-configuration"> <a href="#vs-code-configuration" class="anchor-heading" aria-labelledby="vs-code-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VS Code Configuration </h3> <h4 id="recommended-extensions"> <a href="#recommended-extensions" class="anchor-heading" aria-labelledby="recommended-extensions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommended Extensions </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"recommendations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"bradlc.vscode-tailwindcss"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ms-vscode.vscode-typescript-next"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"esbenp.prettier-vscode"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dbaeumer.vscode-eslint"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"prisma.prisma"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ms-vscode.vscode-json"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"redhat.vscode-yaml"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ms-playwright.playwright"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="workspace-settings"> <a href="#workspace-settings" class="anchor-heading" aria-labelledby="workspace-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Workspace Settings </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"typescript.preferences.importModuleSpecifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"relative"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"editor.formatOnSave"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"editor.defaultFormatter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"esbenp.prettier-vscode"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"editor.codeActionsOnSave"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"source.fixAll.eslint"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"tailwindCSS.includeLanguages"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"typescript"</span><span class="p">:</span><span class="w"> </span><span class="s2">"javascript"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"typescriptreact"</span><span class="p">:</span><span class="w"> </span><span class="s2">"javascript"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h3 id="docker-development-environment"> <a href="#docker-development-environment" class="anchor-heading" aria-labelledby="docker-development-environment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker Development Environment </h3> <h4 id="docker-compose-setup"> <a href="#docker-compose-setup" class="anchor-heading" aria-labelledby="docker-compose-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker Compose Setup </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.dev.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:14</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">advisoros_dev</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>

  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>

  <span class="na">azurite</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mcr.microsoft.com/azure-storage/azurite</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">10000:10000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">10001:10001"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">10002:10002"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">azurite_data:/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">azurite_data</span><span class="pi">:</span>
</code></pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start development services</span>
docker-compose <span class="nt">-f</span> docker-compose.dev.yml up <span class="nt">-d</span>

<span class="c"># Stop services</span>
docker-compose <span class="nt">-f</span> docker-compose.dev.yml down
</code></pre></div></div><hr /> <h2 id="project-architecture-overview"> <a href="#project-architecture-overview" class="anchor-heading" aria-labelledby="project-architecture-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Architecture Overview </h2> <h3 id="monorepo-structure"> <a href="#monorepo-structure" class="anchor-heading" aria-labelledby="monorepo-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monorepo Structure </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>advisoros/
├── apps/
│   └── web/                     # Next.js 14 application
│       ├── src/
│       │   ├── app/            # App Router pages and API routes
│       │   ├── components/     # React components
│       │   ├── hooks/          # Custom React hooks
│       │   ├── lib/           # Utilities and configurations
│       │   ├── server/        # Server-side utilities
│       │   └── types/         # TypeScript type definitions
│       ├── public/            # Static assets
│       ├── prisma/           # Database schema and migrations
│       └── package.json
├── packages/
│   ├── database/              # Prisma client and utilities
│   │   ├── prisma/
│   │   │   ├── schema.prisma  # Database schema
│   │   │   └── migrations/    # Database migrations
│   │   ├── src/
│   │   │   ├── client.ts      # Prisma client configuration
│   │   │   └── seed.ts        # Database seeding
│   │   └── package.json
│   ├── ui/                    # Shared UI components
│   │   ├── src/
│   │   │   ├── components/    # Reusable UI components
│   │   │   ├── hooks/         # Shared hooks
│   │   │   └── utils/         # UI utilities
│   │   └── package.json
│   ├── ai-agents/             # AI service integrations
│   │   ├── src/
│   │   │   ├── openai/        # OpenAI integration
│   │   │   ├── azure/         # Azure AI services
│   │   │   └── types/         # AI-related types
│   │   └── package.json
│   └── types/                 # Shared TypeScript types
│       ├── src/
│       │   ├── api.ts         # API types
│       │   ├── database.ts    # Database types
│       │   └── index.ts       # Exported types
│       └── package.json
├── infrastructure/            # Infrastructure as Code
│   ├── azure/                # Azure Terraform configurations
│   └── docker/               # Docker configurations
├── scripts/                  # Build and deployment scripts
├── docs/                     # Documentation
└── package.json             # Root package.json with workspace config
</code></pre></div></div> <h3 id="technology-stack"> <a href="#technology-stack" class="anchor-heading" aria-labelledby="technology-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technology Stack </h3> <h4 id="frontend-stack"> <a href="#frontend-stack" class="anchor-heading" aria-labelledby="frontend-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Frontend Stack </h4> <ul> <li><strong>Next.js 14</strong>: React framework with App Router</li> <li><strong>TypeScript</strong>: Type-safe JavaScript</li> <li><strong>Tailwind CSS</strong>: Utility-first CSS framework</li> <li><strong>Tremor</strong>: React components for dashboards</li> <li><strong>React Hook Form</strong>: Form state management</li> <li><strong>Zustand</strong>: Lightweight state management</li> <li><strong>React Query</strong>: Server state management</li> </ul> <h4 id="backend-stack"> <a href="#backend-stack" class="anchor-heading" aria-labelledby="backend-stack"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backend Stack </h4> <ul> <li><strong>Next.js API Routes</strong>: Serverless API endpoints</li> <li><strong>Prisma ORM</strong>: Database toolkit</li> <li><strong>PostgreSQL</strong>: Primary database</li> <li><strong>NextAuth.js</strong>: Authentication solution</li> <li><strong>Zod</strong>: Runtime type validation</li> <li><strong>Redis</strong>: Caching and session storage</li> </ul> <h4 id="external-integrations"> <a href="#external-integrations" class="anchor-heading" aria-labelledby="external-integrations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> External Integrations </h4> <ul> <li><strong>QuickBooks Online API</strong>: Financial data synchronization</li> <li><strong>Stripe</strong>: Payment processing</li> <li><strong>Azure Storage</strong>: File storage and management</li> <li><strong>OpenAI</strong>: AI-powered document analysis</li> <li><strong>SendGrid</strong>: Email delivery</li> </ul> <h3 id="architecture-patterns"> <a href="#architecture-patterns" class="anchor-heading" aria-labelledby="architecture-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture Patterns </h3> <h4 id="multi-tenant-architecture"> <a href="#multi-tenant-architecture" class="anchor-heading" aria-labelledby="multi-tenant-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Tenant Architecture </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Tenant isolation at database level</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">withTenant</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="p">{</span> <span class="na">organizationId</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">query</span><span class="p">:</span> <span class="nx">T</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">getServerSession</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">query</span><span class="p">,</span>
    <span class="na">organizationId</span><span class="p">:</span> <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="c1">// Usage in API routes</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">clients</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findMany</span><span class="p">(</span>
    <span class="nx">withTenant</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">active</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">clients</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="service-layer-pattern"> <a href="#service-layer-pattern" class="anchor-heading" aria-labelledby="service-layer-pattern"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service Layer Pattern </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// services/clientService.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ClientService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="nx">prisma</span><span class="p">:</span> <span class="nx">PrismaClient</span><span class="p">,</span>
    <span class="k">private</span> <span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="k">async</span> <span class="nx">createClient</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">CreateClientInput</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Client</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">data</span><span class="p">,</span>
        <span class="na">organizationId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">organizationId</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">updateClient</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">data</span><span class="p">:</span> <span class="nx">UpdateClientInput</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Client</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">id</span><span class="p">,</span>
        <span class="na">organizationId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">organizationId</span>
      <span class="p">},</span>
      <span class="nx">data</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="repository-pattern"> <a href="#repository-pattern" class="anchor-heading" aria-labelledby="repository-pattern"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Repository Pattern </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// repositories/clientRepository.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ClientRepository</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">prisma</span><span class="p">:</span> <span class="nx">PrismaClient</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">async</span> <span class="nx">findByOrganization</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Client</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">},</span>
      <span class="na">include</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">documents</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">quickbooksData</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Client</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findFirst</span><span class="p">({</span>
      <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">organizationId</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="database-architecture"> <a href="#database-architecture" class="anchor-heading" aria-labelledby="database-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Architecture </h2> <h3 id="schema-design-principles"> <a href="#schema-design-principles" class="anchor-heading" aria-labelledby="schema-design-principles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Schema Design Principles </h3> <h4 id="1-multi-tenant-data-isolation"> <a href="#1-multi-tenant-data-isolation" class="anchor-heading" aria-labelledby="1-multi-tenant-data-isolation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Multi-Tenant Data Isolation </h4> <p>Every tenant-specific table includes <code class="language-plaintext highlighter-rouge">organizationId</code> for data isolation:</p><pre><code class="language-prisma">model Client {
  id             String       @id @default(cuid())
  organizationId String       // Tenant isolation
  businessName   String
  // ... other fields

  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@map("clients")
}
</code></pre><h4 id="2-audit-trail-implementation"> <a href="#2-audit-trail-implementation" class="anchor-heading" aria-labelledby="2-audit-trail-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Audit Trail Implementation </h4><pre><code class="language-prisma">model AuditLog {
  id             String    @id @default(cuid())
  organizationId String
  userId         String?
  action         String    // CREATE, UPDATE, DELETE
  resourceType   String    // client, document, etc.
  resourceId     String
  oldValues      Json?
  newValues      Json?
  ipAddress      String?
  userAgent      String?
  createdAt      DateTime  @default(now())

  organization   Organization @relation(fields: [organizationId], references: [id])
  user           User?        @relation(fields: [userId], references: [id])

  @@index([organizationId, createdAt])
  @@index([resourceType, resourceId])
  @@map("audit_logs")
}
</code></pre><h4 id="3-optimized-indexing-strategy"> <a href="#3-optimized-indexing-strategy" class="anchor-heading" aria-labelledby="3-optimized-indexing-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Optimized Indexing Strategy </h4><pre><code class="language-prisma">model Document {
  id             String   @id @default(cuid())
  organizationId String
  clientId       String
  fileName       String
  category       String
  createdAt      DateTime @default(now())

  // Strategic indexes for common query patterns
  @@index([organizationId, clientId])
  @@index([organizationId, category, createdAt])
  @@index([organizationId, createdAt])
  @@fulltext([fileName, description])
  @@map("documents")
}
</code></pre><h3 id="database-relationships"> <a href="#database-relationships" class="anchor-heading" aria-labelledby="database-relationships"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Relationships </h3> <h4 id="entity-relationship-diagram"> <a href="#entity-relationship-diagram" class="anchor-heading" aria-labelledby="entity-relationship-diagram"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entity Relationship Diagram </h4><pre><code class="language-mermaid">erDiagram
    Organization ||--o{ User : has
    Organization ||--o{ Client : contains
    Organization ||--o{ Document : stores
    Organization ||--o{ Workflow : defines

    User ||--o{ Task : assigned
    User ||--o{ Document : uploads
    User ||--o{ Note : creates

    Client ||--o{ Document : owns
    Client ||--o{ Note : has
    Client ||--|| QuickBooksToken : syncs
    Client ||--o{ Engagement : involves

    Document ||--o{ DocumentAnnotation : has
    Document ||--o{ DocumentComment : contains

    Workflow ||--o{ WorkflowExecution : instantiates
    WorkflowExecution ||--o{ TaskExecution : contains

    Subscription ||--|| Organization : belongs_to
    Subscription ||--o{ Invoice : generates
</code></pre><h3 id="data-access-patterns"> <a href="#data-access-patterns" class="anchor-heading" aria-labelledby="data-access-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Access Patterns </h3> <h4 id="1-prisma-client-configuration"> <a href="#1-prisma-client-configuration" class="anchor-heading" aria-labelledby="1-prisma-client-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Prisma Client Configuration </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/prisma.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PrismaClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@prisma/client</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">globalForPrisma</span> <span class="o">=</span> <span class="nx">globalThis</span> <span class="k">as</span> <span class="nx">unknown</span> <span class="k">as</span> <span class="p">{</span>
  <span class="na">prisma</span><span class="p">:</span> <span class="nx">PrismaClient</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">prisma</span> <span class="o">=</span> <span class="nx">globalForPrisma</span><span class="p">.</span><span class="nx">prisma</span> <span class="o">??</span> <span class="k">new</span> <span class="nx">PrismaClient</span><span class="p">({</span>
  <span class="na">log</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="p">?</span> <span class="p">[</span><span class="dl">'</span><span class="s1">query</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">],</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="nx">globalForPrisma</span><span class="p">.</span><span class="nx">prisma</span> <span class="o">=</span> <span class="nx">prisma</span><span class="p">;</span>
</code></pre></div></div> <h4 id="2-type-safe-query-builder"> <a href="#2-type-safe-query-builder" class="anchor-heading" aria-labelledby="2-type-safe-query-builder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Type-Safe Query Builder </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/queryBuilder.ts</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">buildClientQuery</span><span class="p">(</span><span class="nx">params</span><span class="p">:</span> <span class="nx">ClientQueryParams</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">where</span><span class="p">:</span> <span class="nx">Prisma</span><span class="p">.</span><span class="nx">ClientWhereInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">organizationId</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">where</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">where</span><span class="p">.</span><span class="nx">OR</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">businessName</span><span class="p">:</span> <span class="p">{</span> <span class="na">contains</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">insensitive</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="p">{</span> <span class="na">contains</span><span class="p">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">insensitive</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">where</span><span class="p">,</span>
    <span class="na">include</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">documents</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">take</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="na">orderBy</span><span class="p">:</span> <span class="p">{</span> <span class="na">createdAt</span><span class="p">:</span> <span class="dl">'</span><span class="s1">desc</span><span class="dl">'</span> <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">quickbooksData</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="na">orderBy</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">]:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">sortOrder</span> <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="3-transaction-management"> <a href="#3-transaction-management" class="anchor-heading" aria-labelledby="3-transaction-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Transaction Management </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// services/clientService.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">createClientWithDocuments</span><span class="p">(</span>
  <span class="nx">clientData</span><span class="p">:</span> <span class="nx">CreateClientInput</span><span class="p">,</span>
  <span class="nx">documents</span><span class="p">:</span> <span class="nx">DocumentInput</span><span class="p">[]</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">$transaction</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">clientData</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">documentPromises</span> <span class="o">=</span> <span class="nx">documents</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span>
      <span class="nx">tx</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">doc</span><span class="p">,</span>
          <span class="na">clientId</span><span class="p">:</span> <span class="nx">client</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="na">organizationId</span><span class="p">:</span> <span class="nx">client</span><span class="p">.</span><span class="nx">organizationId</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">);</span>

    <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">documentPromises</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">client</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="api-architecture"> <a href="#api-architecture" class="anchor-heading" aria-labelledby="api-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> API Architecture </h2> <h3 id="rest-api-design"> <a href="#rest-api-design" class="anchor-heading" aria-labelledby="rest-api-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> REST API Design </h3> <h4 id="1-consistent-response-format"> <a href="#1-consistent-response-format" class="anchor-heading" aria-labelledby="1-consistent-response-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Consistent Response Format </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/apiResponse.ts</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">ApiResponse</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">success</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">data</span><span class="p">?:</span> <span class="nx">T</span><span class="p">;</span>
  <span class="nl">error</span><span class="p">?:</span> <span class="p">{</span>
    <span class="na">code</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">details</span><span class="p">?:</span> <span class="kr">any</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nl">meta</span><span class="p">?:</span> <span class="p">{</span>
    <span class="na">timestamp</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">requestId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">pagination</span><span class="p">?:</span> <span class="nx">PaginationMeta</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">createApiResponse</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">data</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
  <span class="nx">meta</span><span class="p">?:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">ApiResponse</span><span class="p">[</span><span class="dl">'</span><span class="s1">meta</span><span class="dl">'</span><span class="p">]</span><span class="o">&gt;</span>
<span class="p">):</span> <span class="nx">ApiResponse</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">data</span><span class="p">,</span>
    <span class="na">meta</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
      <span class="na">requestId</span><span class="p">:</span> <span class="nx">generateRequestId</span><span class="p">(),</span>
      <span class="p">...</span><span class="nx">meta</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="2-error-handling-middleware"> <a href="#2-error-handling-middleware" class="anchor-heading" aria-labelledby="2-error-handling-middleware"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Error Handling Middleware </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// middleware/errorHandler.ts</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">withErrorHandler</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[],</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">handler</span><span class="p">:</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">R</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">async</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">createApiResponse</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">API Error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">ValidationError</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
          <span class="nx">createErrorResponse</span><span class="p">(</span><span class="dl">'</span><span class="s1">VALIDATION_ERROR</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">details</span><span class="p">),</span>
          <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">400</span> <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">AuthorizationError</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
          <span class="nx">createErrorResponse</span><span class="p">(</span><span class="dl">'</span><span class="s1">UNAUTHORIZED</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Access denied</span><span class="dl">'</span><span class="p">),</span>
          <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">403</span> <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
        <span class="nx">createErrorResponse</span><span class="p">(</span><span class="dl">'</span><span class="s1">INTERNAL_ERROR</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">An unexpected error occurred</span><span class="dl">'</span><span class="p">),</span>
        <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">500</span> <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="3-authentication--authorization"> <a href="#3-authentication--authorization" class="anchor-heading" aria-labelledby="3-authentication--authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Authentication &amp; Authorization </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// middleware/auth.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">withAuth</span><span class="p">(</span>
  <span class="nx">handler</span><span class="p">:</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="nx">AuthContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getServerSession</span><span class="p">(</span><span class="nx">authOptions</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">session</span><span class="p">?.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
        <span class="nx">createErrorResponse</span><span class="p">(</span><span class="dl">'</span><span class="s1">AUTHENTICATION_REQUIRED</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Authentication required</span><span class="dl">'</span><span class="p">),</span>
        <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">401</span> <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="na">context</span><span class="p">:</span> <span class="nx">AuthContext</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">user</span><span class="p">:</span> <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span>
      <span class="na">organizationId</span><span class="p">:</span> <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Usage in API routes</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">GET</span> <span class="o">=</span> <span class="nx">withAuth</span><span class="p">(</span><span class="nx">withErrorHandler</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">clients</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">clientService</span><span class="p">.</span><span class="nx">findByOrganization</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">clients</span><span class="p">;</span>
<span class="p">}));</span>
</code></pre></div></div> <h4 id="4-input-validation"> <a href="#4-input-validation" class="anchor-heading" aria-labelledby="4-input-validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Input Validation </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// schemas/clientSchemas.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">z</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">zod</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">createClientSchema</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
  <span class="na">businessName</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">max</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="na">legalName</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
  <span class="na">taxId</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^</span><span class="se">\d{2}</span><span class="sr">-</span><span class="se">\d{7}</span><span class="sr">$/</span><span class="p">).</span><span class="nx">optional</span><span class="p">(),</span>
  <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">email</span><span class="p">(),</span>
  <span class="na">businessType</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">enum</span><span class="p">([</span><span class="dl">'</span><span class="s1">LLC</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Corporation</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Partnership</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Sole_Proprietorship</span><span class="dl">'</span><span class="p">]),</span>
  <span class="na">industry</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
  <span class="na">website</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">().</span><span class="nx">url</span><span class="p">().</span><span class="nx">optional</span><span class="p">(),</span>
  <span class="na">customFields</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">record</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="kr">any</span><span class="p">()).</span><span class="nx">optional</span><span class="p">()</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">updateClientSchema</span> <span class="o">=</span> <span class="nx">createClientSchema</span><span class="p">.</span><span class="nx">partial</span><span class="p">();</span>

<span class="c1">// Usage in API route</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">POST</span> <span class="o">=</span> <span class="nx">withAuth</span><span class="p">(</span><span class="nx">withErrorHandler</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">validatedData</span> <span class="o">=</span> <span class="nx">createClientSchema</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">clientService</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">validatedData</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">client</span><span class="p">;</span>
<span class="p">}));</span>
</code></pre></div></div> <h3 id="real-time-features"> <a href="#real-time-features" class="anchor-heading" aria-labelledby="real-time-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-Time Features </h3> <h4 id="websocket-integration"> <a href="#websocket-integration" class="anchor-heading" aria-labelledby="websocket-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> WebSocket Integration </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/websocket.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Server</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">initializeWebSocket</span><span class="p">(</span><span class="nx">server</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">io</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Server</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">origin</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXTAUTH_URL</span><span class="p">,</span>
      <span class="na">methods</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">handshake</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">verifyJwtToken</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">organizationId</span> <span class="o">=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">next</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authentication error</span><span class="dl">'</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Join organization room for tenant isolation</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">`org:</span><span class="p">${</span><span class="nx">socket</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">document:upload:progress</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="s2">`org:</span><span class="p">${</span><span class="nx">socket</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">document:upload:progress</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">io</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="server-sent-events-for-real-time-updates"> <a href="#server-sent-events-for-real-time-updates" class="anchor-heading" aria-labelledby="server-sent-events-for-real-time-updates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server-Sent Events for Real-Time Updates </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/events/route.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">searchParams</span> <span class="p">}</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">organizationId</span> <span class="o">=</span> <span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">organizationId</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReadableStream</span><span class="p">({</span>
    <span class="nx">start</span><span class="p">(</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextEncoder</span><span class="p">();</span>

      <span class="c1">// Send initial connection message</span>
      <span class="nx">controller</span><span class="p">.</span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="dl">'</span><span class="s1">data: {"type":"connected"}</span><span class="se">\n\n</span><span class="dl">'</span><span class="p">));</span>

      <span class="c1">// Subscribe to organization-specific events</span>
      <span class="kd">const</span> <span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">`org:</span><span class="p">${</span><span class="nx">organizationId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">controller</span><span class="p">.</span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="s2">`data: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">)}</span><span class="s2">\n\n`</span><span class="p">));</span>
      <span class="p">});</span>

      <span class="c1">// Cleanup on connection close</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">signal</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">abort</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">unsubscribe</span><span class="p">();</span>
        <span class="nx">controller</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/event-stream</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Cache-Control</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cache</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">Connection</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">keep-alive</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="api-rate-limiting"> <a href="#api-rate-limiting" class="anchor-heading" aria-labelledby="api-rate-limiting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> API Rate Limiting </h3> <h4 id="rate-limiting-implementation"> <a href="#rate-limiting-implementation" class="anchor-heading" aria-labelledby="rate-limiting-implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Rate Limiting Implementation </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// middleware/rateLimit.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Redis</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@upstash/redis</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">redis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Redis</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UPSTASH_REDIS_REST_URL</span><span class="o">!</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UPSTASH_REDIS_REST_TOKEN</span><span class="o">!</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">withRateLimit</span><span class="p">(</span>
  <span class="nx">requests</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
  <span class="nx">windowMs</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1">// 1 minute</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">middleware</span><span class="p">(</span>
    <span class="nx">handler</span><span class="p">:</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">ip</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">x-forwarded-for</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">`rate_limit:</span><span class="p">${</span><span class="nx">ip</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

      <span class="kd">const</span> <span class="nx">current</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">incr</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">expire</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">windowMs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span> <span class="o">&gt;</span> <span class="nx">requests</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
          <span class="nx">createErrorResponse</span><span class="p">(</span><span class="dl">'</span><span class="s1">RATE_LIMIT_EXCEEDED</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Too many requests</span><span class="dl">'</span><span class="p">),</span>
          <span class="p">{</span>
            <span class="na">status</span><span class="p">:</span> <span class="mi">429</span><span class="p">,</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">'</span><span class="s1">X-RateLimit-Limit</span><span class="dl">'</span><span class="p">:</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
              <span class="dl">'</span><span class="s1">X-RateLimit-Remaining</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">,</span>
              <span class="dl">'</span><span class="s1">X-RateLimit-Reset</span><span class="dl">'</span><span class="p">:</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">+</span> <span class="nx">windowMs</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-RateLimit-Limit</span><span class="dl">'</span><span class="p">,</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">X-RateLimit-Remaining</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">requests</span> <span class="o">-</span> <span class="nx">current</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>

      <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="frontend-architecture"> <a href="#frontend-architecture" class="anchor-heading" aria-labelledby="frontend-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Frontend Architecture </h2> <h3 id="component-architecture"> <a href="#component-architecture" class="anchor-heading" aria-labelledby="component-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Component Architecture </h3> <h4 id="1-component-structure"> <a href="#1-component-structure" class="anchor-heading" aria-labelledby="1-component-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Component Structure </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/components/
├── ui/                    # Base UI components (buttons, inputs, etc.)
│   ├── Button.tsx
│   ├── Input.tsx
│   ├── Modal.tsx
│   └── index.ts
├── forms/                 # Form components
│   ├── ClientForm.tsx
│   ├── DocumentUpload.tsx
│   └── index.ts
├── layout/                # Layout components
│   ├── Navigation.tsx
│   ├── Sidebar.tsx
│   ├── Header.tsx
│   └── index.ts
├── features/              # Feature-specific components
│   ├── clients/
│   │   ├── ClientList.tsx
│   │   ├── ClientCard.tsx
│   │   └── ClientDetails.tsx
│   ├── documents/
│   │   ├── DocumentViewer.tsx
│   │   ├── DocumentList.tsx
│   │   └── OCRResults.tsx
│   └── workflows/
└── charts/                # Data visualization components
    ├── RevenueChart.tsx
    ├── ClientGrowthChart.tsx
    └── index.ts
</code></pre></div></div> <h4 id="2-component-design-patterns"> <a href="#2-component-design-patterns" class="anchor-heading" aria-labelledby="2-component-design-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Component Design Patterns </h4> <p><strong>Container/Presentation Pattern:</strong></p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/features/clients/ClientListContainer.tsx</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">ClientListContainer</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">clients</span><span class="p">,</span> <span class="nx">isLoading</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useClients</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">filters</span><span class="p">,</span> <span class="nx">setFilters</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">ClientFilters</span><span class="o">&gt;</span><span class="p">({});</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isLoading</span><span class="p">)</span> <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ClientListSkeleton</span> <span class="o">/&gt;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ErrorMessage</span> <span class="nx">error</span><span class="o">=</span><span class="p">{</span><span class="nx">error</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">ClientListPresentation</span>
      <span class="nx">clients</span><span class="o">=</span><span class="p">{</span><span class="nx">clients</span><span class="p">}</span>
      <span class="nx">filters</span><span class="o">=</span><span class="p">{</span><span class="nx">filters</span><span class="p">}</span>
      <span class="nx">onFiltersChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setFilters</span><span class="p">}</span>
    <span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// components/features/clients/ClientListPresentation.tsx</span>
<span class="kr">interface</span> <span class="nx">ClientListPresentationProps</span> <span class="p">{</span>
  <span class="nl">clients</span><span class="p">:</span> <span class="nx">Client</span><span class="p">[];</span>
  <span class="nl">filters</span><span class="p">:</span> <span class="nx">ClientFilters</span><span class="p">;</span>
  <span class="nl">onFiltersChange</span><span class="p">:</span> <span class="p">(</span><span class="nx">filters</span><span class="p">:</span> <span class="nx">ClientFilters</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">ClientListPresentation</span><span class="p">({</span>
  <span class="nx">clients</span><span class="p">,</span>
  <span class="nx">filters</span><span class="p">,</span>
  <span class="nx">onFiltersChange</span>
<span class="p">}:</span> <span class="nx">ClientListPresentationProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">space-y-4</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ClientFilters</span> <span class="nx">filters</span><span class="o">=</span><span class="p">{</span><span class="nx">filters</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onFiltersChange</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">ClientGrid</span> <span class="nx">clients</span><span class="o">=</span><span class="p">{</span><span class="nx">clients</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Compound Component Pattern:</strong></p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/ui/Modal.tsx</span>
<span class="kr">interface</span> <span class="nx">ModalProps</span> <span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
  <span class="nl">isOpen</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">onClose</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">Modal</span><span class="p">({</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">isOpen</span><span class="p">,</span> <span class="nx">onClose</span> <span class="p">}:</span> <span class="nx">ModalProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isOpen</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">modal-overlay</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClose</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">modal-content</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

<span class="nx">Modal</span><span class="p">.</span><span class="nx">Header</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ModalHeader</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">modal-header</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span><span class="p">};</span>

<span class="nx">Modal</span><span class="p">.</span><span class="nx">Body</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ModalBody</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">modal-body</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span><span class="p">};</span>

<span class="nx">Modal</span><span class="p">.</span><span class="nx">Footer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">ModalFooter</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">modal-footer</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span><span class="p">};</span>

<span class="c1">// Usage</span>
<span class="o">&lt;</span><span class="nx">Modal</span> <span class="nx">isOpen</span><span class="o">=</span><span class="p">{</span><span class="nx">isOpen</span><span class="p">}</span> <span class="nx">onClose</span><span class="o">=</span><span class="p">{</span><span class="nx">onClose</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">Modal</span><span class="p">.</span><span class="nx">Header</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Edit</span> <span class="nx">Client</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Modal.Header</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">Modal</span><span class="p">.</span><span class="nx">Body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">ClientForm</span> <span class="nx">client</span><span class="o">=</span><span class="p">{</span><span class="nx">client</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Modal.Body</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">Modal</span><span class="p">.</span><span class="nx">Footer</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onSave</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Save</span><span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClose</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Cancel</span><span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/Modal.Footer</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/Modal</span><span class="err">&gt;
</span></code></pre></div></div> <h4 id="3-state-management"> <a href="#3-state-management" class="anchor-heading" aria-labelledby="3-state-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. State Management </h4> <p><strong>Global State with Zustand:</strong></p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// stores/useClientStore.ts</span>
<span class="kr">interface</span> <span class="nx">ClientStore</span> <span class="p">{</span>
  <span class="nl">clients</span><span class="p">:</span> <span class="nx">Client</span><span class="p">[];</span>
  <span class="nl">selectedClient</span><span class="p">:</span> <span class="nx">Client</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nl">filters</span><span class="p">:</span> <span class="nx">ClientFilters</span><span class="p">;</span>
  <span class="nl">setClients</span><span class="p">:</span> <span class="p">(</span><span class="nx">clients</span><span class="p">:</span> <span class="nx">Client</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">setSelectedClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">client</span><span class="p">:</span> <span class="nx">Client</span> <span class="o">|</span> <span class="kc">null</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">updateFilters</span><span class="p">:</span> <span class="p">(</span><span class="nx">filters</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">ClientFilters</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">addClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">client</span><span class="p">:</span> <span class="nx">Client</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">updateClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">updates</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">Client</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">removeClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useClientStore</span> <span class="o">=</span> <span class="nx">create</span><span class="o">&lt;</span><span class="nx">ClientStore</span><span class="o">&gt;</span><span class="p">((</span><span class="kd">set</span><span class="p">,</span> <span class="kd">get</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">clients</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">selectedClient</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">filters</span><span class="p">:</span> <span class="p">{},</span>

  <span class="na">setClients</span><span class="p">:</span> <span class="p">(</span><span class="nx">clients</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">set</span><span class="p">({</span> <span class="nx">clients</span> <span class="p">}),</span>

  <span class="na">setSelectedClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">selectedClient</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">set</span><span class="p">({</span> <span class="nx">selectedClient</span> <span class="p">}),</span>

  <span class="na">updateFilters</span><span class="p">:</span> <span class="p">(</span><span class="nx">newFilters</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="kd">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">filters</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">filters</span><span class="p">,</span> <span class="p">...</span><span class="nx">newFilters</span> <span class="p">}</span>
    <span class="p">})),</span>

  <span class="na">addClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">client</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="kd">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">clients</span><span class="p">:</span> <span class="p">[...</span><span class="nx">state</span><span class="p">.</span><span class="nx">clients</span><span class="p">,</span> <span class="nx">client</span><span class="p">]</span>
    <span class="p">})),</span>

  <span class="na">updateClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">updates</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="kd">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">clients</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">client</span> <span class="o">=&gt;</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span> <span class="p">?</span> <span class="p">{</span> <span class="p">...</span><span class="nx">client</span><span class="p">,</span> <span class="p">...</span><span class="nx">updates</span> <span class="p">}</span> <span class="p">:</span> <span class="nx">client</span>
      <span class="p">)</span>
    <span class="p">})),</span>

  <span class="na">removeClient</span><span class="p">:</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="kd">set</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="na">clients</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">client</span> <span class="o">=&gt;</span> <span class="nx">client</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">)</span>
    <span class="p">}))</span>
<span class="p">}));</span>
</code></pre></div></div> <p><strong>Server State with React Query:</strong></p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hooks/useClients.ts</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">useClients</span><span class="p">(</span><span class="nx">filters</span><span class="p">?:</span> <span class="nx">ClientFilters</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">useQuery</span><span class="p">({</span>
    <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">clients</span><span class="dl">'</span><span class="p">,</span> <span class="nx">filters</span><span class="p">],</span>
    <span class="na">queryFn</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">clientApi</span><span class="p">.</span><span class="nx">getClients</span><span class="p">(</span><span class="nx">filters</span><span class="p">),</span>
    <span class="na">staleTime</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 5 minutes</span>
    <span class="na">cacheTime</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 10 minutes</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">useCreateClient</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">queryClient</span> <span class="o">=</span> <span class="nx">useQueryClient</span><span class="p">();</span>

  <span class="k">return</span> <span class="nx">useMutation</span><span class="p">({</span>
    <span class="na">mutationFn</span><span class="p">:</span> <span class="nx">clientApi</span><span class="p">.</span><span class="nx">createClient</span><span class="p">,</span>
    <span class="na">onSuccess</span><span class="p">:</span> <span class="p">(</span><span class="nx">newClient</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Update cache</span>
      <span class="nx">queryClient</span><span class="p">.</span><span class="nx">setQueryData</span><span class="p">([</span><span class="dl">'</span><span class="s1">clients</span><span class="dl">'</span><span class="p">],</span> <span class="p">(</span><span class="na">oldData</span><span class="p">:</span> <span class="nx">Client</span><span class="p">[])</span> <span class="o">=&gt;</span>
        <span class="nx">oldData</span> <span class="p">?</span> <span class="p">[...</span><span class="nx">oldData</span><span class="p">,</span> <span class="nx">newClient</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="nx">newClient</span><span class="p">]</span>
      <span class="p">);</span>

      <span class="c1">// Invalidate related queries</span>
      <span class="nx">queryClient</span><span class="p">.</span><span class="nx">invalidateQueries</span><span class="p">({</span> <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">clients</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
    <span class="p">},</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="4-form-management"> <a href="#4-form-management" class="anchor-heading" aria-labelledby="4-form-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Form Management </h4> <p><strong>React Hook Form Integration:</strong></p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/forms/ClientForm.tsx</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useForm</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-hook-form</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">zodResolver</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@hookform/resolvers/zod</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">ClientFormProps</span> <span class="p">{</span>
  <span class="nl">client</span><span class="p">?:</span> <span class="nx">Client</span><span class="p">;</span>
  <span class="nl">onSubmit</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">ClientFormData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onCancel</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">ClientForm</span><span class="p">({</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">onSubmit</span><span class="p">,</span> <span class="nx">onCancel</span> <span class="p">}:</span> <span class="nx">ClientFormProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span>
    <span class="nx">register</span><span class="p">,</span>
    <span class="nx">handleSubmit</span><span class="p">,</span>
    <span class="na">formState</span><span class="p">:</span> <span class="p">{</span> <span class="nx">errors</span><span class="p">,</span> <span class="nx">isSubmitting</span> <span class="p">},</span>
    <span class="nx">watch</span><span class="p">,</span>
    <span class="nx">setValue</span>
  <span class="p">}</span> <span class="o">=</span> <span class="nx">useForm</span><span class="o">&lt;</span><span class="nx">ClientFormData</span><span class="o">&gt;</span><span class="p">({</span>
    <span class="na">resolver</span><span class="p">:</span> <span class="nx">zodResolver</span><span class="p">(</span><span class="nx">clientFormSchema</span><span class="p">),</span>
    <span class="na">defaultValues</span><span class="p">:</span> <span class="nx">client</span> <span class="o">||</span> <span class="p">{},</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">onSubmit</span><span class="p">)}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">space-y-4</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Input</span>
        <span class="nx">label</span><span class="o">=</span><span class="dl">"</span><span class="s2">Business Name</span><span class="dl">"</span>
        <span class="p">{...</span><span class="nx">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">businessName</span><span class="dl">'</span><span class="p">)}</span>
        <span class="nx">error</span><span class="o">=</span><span class="p">{</span><span class="nx">errors</span><span class="p">.</span><span class="nx">businessName</span><span class="p">?.</span><span class="nx">message</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>
      <span class="o">&lt;</span><span class="nx">Input</span>
        <span class="nx">label</span><span class="o">=</span><span class="dl">"</span><span class="s2">Primary Contact Email</span><span class="dl">"</span>
        <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span>
        <span class="p">{...</span><span class="nx">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">primaryContactEmail</span><span class="dl">'</span><span class="p">)}</span>
        <span class="nx">error</span><span class="o">=</span><span class="p">{</span><span class="nx">errors</span><span class="p">.</span><span class="nx">primaryContactEmail</span><span class="p">?.</span><span class="nx">message</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>
      <span class="o">&lt;</span><span class="nx">Select</span>
        <span class="nx">label</span><span class="o">=</span><span class="dl">"</span><span class="s2">Business Type</span><span class="dl">"</span>
        <span class="p">{...</span><span class="nx">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">businessType</span><span class="dl">'</span><span class="p">)}</span>
        <span class="nx">error</span><span class="o">=</span><span class="p">{</span><span class="nx">errors</span><span class="p">.</span><span class="nx">businessType</span><span class="p">?.</span><span class="nx">message</span><span class="p">}</span>
      <span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">option</span> <span class="nx">value</span><span class="o">=</span><span class="dl">""</span><span class="o">&gt;</span><span class="nx">Select</span> <span class="nx">business</span> <span class="kd">type</span><span class="o">&lt;</span><span class="sr">/option</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">option</span> <span class="nx">value</span><span class="o">=</span><span class="dl">"</span><span class="s2">LLC</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">LLC</span><span class="o">&lt;</span><span class="sr">/option</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">option</span> <span class="nx">value</span><span class="o">=</span><span class="dl">"</span><span class="s2">Corporation</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Corporation</span><span class="o">&lt;</span><span class="sr">/option</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">option</span> <span class="nx">value</span><span class="o">=</span><span class="dl">"</span><span class="s2">Partnership</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Partnership</span><span class="o">&lt;</span><span class="sr">/option</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/Select</span><span class="err">&gt;
</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">flex justify-end space-x-2</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Button</span> <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span> <span class="nx">variant</span><span class="o">=</span><span class="dl">"</span><span class="s2">secondary</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onCancel</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="nx">Cancel</span>
        <span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">Button</span> <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">submit</span><span class="dl">"</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isSubmitting</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">isSubmitting</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Saving...</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Save</span><span class="dl">'</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="development-workflow"> <a href="#development-workflow" class="anchor-heading" aria-labelledby="development-workflow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Workflow </h2> <h3 id="git-workflow"> <a href="#git-workflow" class="anchor-heading" aria-labelledby="git-workflow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Git Workflow </h3> <h4 id="branch-strategy"> <a href="#branch-strategy" class="anchor-heading" aria-labelledby="branch-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Branch Strategy </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Feature branch workflow</span>
git checkout main
git pull origin main
git checkout <span class="nt">-b</span> feature/client-management-improvements

<span class="c"># Make changes, commit frequently</span>
git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"feat: add client search functionality"</span>

<span class="c"># Push feature branch</span>
git push origin feature/client-management-improvements

<span class="c"># Create pull request</span>
gh <span class="nb">pr </span>create <span class="nt">--title</span> <span class="s2">"Add client search functionality"</span> <span class="nt">--body</span> <span class="s2">"Implements search and filtering for client list"</span>
</code></pre></div></div> <h4 id="commit-message-convention"> <a href="#commit-message-convention" class="anchor-heading" aria-labelledby="commit-message-convention"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commit Message Convention </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Format: type(scope): description</span>
feat<span class="o">(</span>clients<span class="o">)</span>: add advanced search functionality
fix<span class="o">(</span>auth<span class="o">)</span>: resolve session <span class="nb">timeout </span>issue
docs<span class="o">(</span>api<span class="o">)</span>: update authentication documentation
refactor<span class="o">(</span>database<span class="o">)</span>: optimize client queries
<span class="nb">test</span><span class="o">(</span>components<span class="o">)</span>: add tests <span class="k">for </span>ClientForm
chore<span class="o">(</span>deps<span class="o">)</span>: update dependencies to latest versions
</code></pre></div></div> <h3 id="code-quality-tools"> <a href="#code-quality-tools" class="anchor-heading" aria-labelledby="code-quality-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Quality Tools </h3> <h4 id="eslint-configuration"> <a href="#eslint-configuration" class="anchor-heading" aria-labelledby="eslint-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ESLint Configuration </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">.eslintrc.json</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"extends"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"next/core-web-vitals"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"@typescript-eslint/recommended"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"prettier"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@typescript-eslint/no-unused-vars"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"@typescript-eslint/no-explicit-any"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warn"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"prefer-const"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"no-var"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="prettier-configuration"> <a href="#prettier-configuration" class="anchor-heading" aria-labelledby="prettier-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prettier Configuration </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">.prettierrc</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"semi"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"trailingComma"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"singleQuote"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"printWidth"</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tabWidth"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"useTabs"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="husky-pre-commit-hooks"> <a href="#husky-pre-commit-hooks" class="anchor-heading" aria-labelledby="husky-pre-commit-hooks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Husky Pre-commit Hooks </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"husky"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"hooks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"pre-commit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lint-staged"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pre-push"</span><span class="p">:</span><span class="w"> </span><span class="s2">"npm run type-check &amp;&amp; npm run test"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"lint-staged"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"*.{ts,tsx}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"eslint --fix"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"prettier --write"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"*.{json,md}"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"prettier --write"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h3 id="development-scripts"> <a href="#development-scripts" class="anchor-heading" aria-labelledby="development-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Scripts </h3> <h4 id="packagejson-scripts"> <a href="#packagejson-scripts" class="anchor-heading" aria-labelledby="packagejson-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Package.json Scripts </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run dev --parallel"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run build"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run start"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run lint"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type-check"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run type-check"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test:watch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run test:watch"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test:coverage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run test:coverage"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"db:push"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run db:push"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"db:studio"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run db:studio"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"db:seed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run db:seed"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"db:migrate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run db:migrate"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"prettier --write </span><span class="se">\"</span><span class="s2">**/*.{ts,tsx,js,jsx,json,md}</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"turbo run clean &amp;&amp; rm -rf node_modules"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="turbo-configuration"> <a href="#turbo-configuration" class="anchor-heading" aria-labelledby="turbo-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Turbo Configuration </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">turbo.json</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"pipeline"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"^build"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".next/**"</span><span class="p">,</span><span class="w"> </span><span class="s2">"!.next/cache/**"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dist/**"</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"cache"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"type-check"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"^build"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"^build"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"coverage/**"</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"db:push"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"cache"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"db:studio"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"cache"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><hr /> <h2 id="testing-strategy"> <a href="#testing-strategy" class="anchor-heading" aria-labelledby="testing-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing Strategy </h2> <h3 id="testing-pyramid"> <a href="#testing-pyramid" class="anchor-heading" aria-labelledby="testing-pyramid"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing Pyramid </h3> <h4 id="unit-tests-jest--testing-library"> <a href="#unit-tests-jest--testing-library" class="anchor-heading" aria-labelledby="unit-tests-jest--testing-library"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unit Tests (Jest + Testing Library) </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// __tests__/components/ClientForm.test.tsx</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">screen</span><span class="p">,</span> <span class="nx">fireEvent</span><span class="p">,</span> <span class="nx">waitFor</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@testing-library/react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ClientForm</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/components/forms/ClientForm</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">ClientForm</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mockOnSubmit</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">mockOnCancel</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>

  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">jest</span><span class="p">.</span><span class="nx">clearAllMocks</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">renders all required fields</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ClientForm</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span> <span class="nx">onCancel</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnCancel</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/business name/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/primary contact email/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/business type/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">validates required fields</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ClientForm</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span> <span class="nx">onCancel</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnCancel</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">);</span>

    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="sr">/save/i</span> <span class="p">}));</span>

    <span class="k">await</span> <span class="nx">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/business name is required/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="sr">/email is required/i</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">submits form with valid data</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ClientForm</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnSubmit</span><span class="p">}</span> <span class="nx">onCancel</span><span class="o">=</span><span class="p">{</span><span class="nx">mockOnCancel</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">);</span>

    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/business name/i</span><span class="p">),</span> <span class="p">{</span>
      <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Test Company</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/primary contact email/i</span><span class="p">),</span> <span class="p">{</span>
      <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test@example.com</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByLabelText</span><span class="p">(</span><span class="sr">/business type/i</span><span class="p">),</span> <span class="p">{</span>
      <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">LLC</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByRole</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="sr">/save/i</span> <span class="p">}));</span>

    <span class="k">await</span> <span class="nx">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">mockOnSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">({</span>
        <span class="na">businessName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Test Company</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test@example.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">businessType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">LLC</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h4 id="integration-tests"> <a href="#integration-tests" class="anchor-heading" aria-labelledby="integration-tests"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Integration Tests </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// __tests__/api/clients.test.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createMocks</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-mocks-http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">handler</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/pages/api/clients</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">prismaMock</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/lib/prisma-mock</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">@/lib/prisma</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">prisma</span><span class="p">:</span> <span class="nx">prismaMock</span>
<span class="p">}));</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/clients</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET returns clients for authenticated user</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">createMocks</span><span class="p">({</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">authorization</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer valid-token</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">mockClients</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">,</span> <span class="na">businessName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Test Company</span><span class="dl">'</span><span class="p">,</span> <span class="na">organizationId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">org-1</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">];</span>

    <span class="nx">prismaMock</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findMany</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockClients</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">_getStatusCode</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">_getData</span><span class="p">())).</span><span class="nx">toEqual</span><span class="p">({</span>
      <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">mockClients</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST creates new client</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">createMocks</span><span class="p">({</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">authorization</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer valid-token</span><span class="dl">'</span>
      <span class="p">},</span>
      <span class="na">body</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">businessName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New Company</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="dl">'</span><span class="s1">contact@newcompany.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">businessType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">LLC</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">mockClient</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">businessName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">New Company</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">organizationId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">org-1</span><span class="dl">'</span>
    <span class="p">};</span>

    <span class="nx">prismaMock</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">mockClient</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">_getStatusCode</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">_getData</span><span class="p">())).</span><span class="nx">toEqual</span><span class="p">({</span>
      <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">mockClient</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h4 id="end-to-end-tests-playwright"> <a href="#end-to-end-tests-playwright" class="anchor-heading" aria-labelledby="end-to-end-tests-playwright"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> End-to-End Tests (Playwright) </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// e2e/client-management.spec.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">test</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@playwright/test</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">test</span><span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Client Management</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span> <span class="p">({</span> <span class="nx">page</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Login</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="email"]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">test@example.com</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="password"]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">button[type="submit"]</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">waitForURL</span><span class="p">(</span><span class="dl">'</span><span class="s1">/dashboard</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">should create new client</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">page</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">'</span><span class="s1">/clients</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">text=Add Client</span><span class="dl">'</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="businessName"]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Test Company</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="primaryContactEmail"]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">test@company.com</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">selectOption</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="businessType"]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">LLC</span><span class="dl">'</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">'</span><span class="s1">button[type="submit"]</span><span class="dl">'</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="dl">'</span><span class="s1">text=Client created successfully</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
    <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="dl">'</span><span class="s1">text=Test Company</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">should search clients</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">page</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">'</span><span class="s1">/clients</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="dl">'</span><span class="s1">[placeholder="Search clients..."]</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Acme</span><span class="dl">'</span><span class="p">);</span>

    <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid="client-list"]</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toContainText</span><span class="p">(</span><span class="dl">'</span><span class="s1">Acme</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">locator</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-testid="client-list"] &gt;&gt; text=Other Company</span><span class="dl">'</span><span class="p">)).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeVisible</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="test-configuration"> <a href="#test-configuration" class="anchor-heading" aria-labelledby="test-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test Configuration </h3> <h4 id="jest-configuration"> <a href="#jest-configuration" class="anchor-heading" aria-labelledby="jest-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Jest Configuration </h4> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jest.config.js</span>
<span class="kd">const</span> <span class="nx">nextJest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">next/jest</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">createJestConfig</span> <span class="o">=</span> <span class="nx">nextJest</span><span class="p">({</span>
  <span class="na">dir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">customJestConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">setupFilesAfterEnv</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">&lt;rootDir&gt;/jest.setup.js</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">moduleNameMapping</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">^@/(.*)$</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">&lt;rootDir&gt;/src/$1</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">testEnvironment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">jest-environment-jsdom</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">collectCoverageFrom</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">'</span><span class="s1">src/**/*.{ts,tsx}</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">!src/**/*.d.ts</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">!src/**/index.ts</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">coverageThreshold</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">global</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">branches</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="na">functions</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="na">lines</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="na">statements</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">createJestConfig</span><span class="p">(</span><span class="nx">customJestConfig</span><span class="p">);</span>
</code></pre></div></div> <h4 id="playwright-configuration"> <a href="#playwright-configuration" class="anchor-heading" aria-labelledby="playwright-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Playwright Configuration </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// playwright.config.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">defineConfig</span><span class="p">,</span> <span class="nx">devices</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@playwright/test</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
  <span class="na">testDir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./e2e</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">fullyParallel</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">forbidOnly</span><span class="p">:</span> <span class="o">!!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span><span class="p">,</span>
  <span class="na">retries</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span> <span class="p">?</span> <span class="mi">2</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">workers</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="na">reporter</span><span class="p">:</span> <span class="dl">'</span><span class="s1">html</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">use</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">baseURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">trace</span><span class="p">:</span> <span class="dl">'</span><span class="s1">on-first-retry</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">projects</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">chromium</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">use</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="dl">'</span><span class="s1">Desktop Chrome</span><span class="dl">'</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">firefox</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">use</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="dl">'</span><span class="s1">Desktop Firefox</span><span class="dl">'</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">webkit</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">use</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span><span class="nx">devices</span><span class="p">[</span><span class="dl">'</span><span class="s1">Desktop Safari</span><span class="dl">'</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">],</span>
  <span class="na">webServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">command</span><span class="p">:</span> <span class="dl">'</span><span class="s1">npm run dev</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">reuseExistingServer</span><span class="p">:</span> <span class="o">!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">CI</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div><hr /> <h2 id="debugging-and-monitoring"> <a href="#debugging-and-monitoring" class="anchor-heading" aria-labelledby="debugging-and-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging and Monitoring </h2> <h3 id="development-debugging"> <a href="#development-debugging" class="anchor-heading" aria-labelledby="development-debugging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Debugging </h3> <h4 id="vs-code-debug-configuration"> <a href="#vs-code-debug-configuration" class="anchor-heading" aria-labelledby="vs-code-debug-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VS Code Debug Configuration </h4> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">.vscode/launch.json</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Next.js: debug server-side"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/node_modules/.bin/next"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dev"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"console"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integratedTerminal"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"skipFiles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"&lt;node_internals&gt;/**"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"NODE_OPTIONS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"--inspect"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Next.js: debug client-side"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chrome"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:3000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"webRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="logging-configuration"> <a href="#logging-configuration" class="anchor-heading" aria-labelledby="logging-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logging Configuration </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/logger.ts</span>
<span class="k">import</span> <span class="nx">winston</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">winston</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">createLogger</span><span class="p">({</span>
  <span class="na">level</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">LOG_LEVEL</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">format</span><span class="p">:</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span>
    <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">(),</span>
    <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">errors</span><span class="p">({</span> <span class="na">stack</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span>
    <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
  <span class="p">),</span>
  <span class="na">defaultMeta</span><span class="p">:</span> <span class="p">{</span> <span class="na">service</span><span class="p">:</span> <span class="dl">'</span><span class="s1">advisoros</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">transports</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">({</span> <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">logs/error.log</span><span class="dl">'</span><span class="p">,</span> <span class="na">level</span><span class="p">:</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span> <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">File</span><span class="p">({</span> <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">logs/combined.log</span><span class="dl">'</span> <span class="p">}),</span>
  <span class="p">],</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">logger</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">winston</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">simple</span><span class="p">()</span>
  <span class="p">}));</span>
<span class="p">}</span>

<span class="k">export</span> <span class="p">{</span> <span class="nx">logger</span> <span class="p">};</span>
</code></pre></div></div> <h3 id="production-monitoring"> <a href="#production-monitoring" class="anchor-heading" aria-labelledby="production-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Production Monitoring </h3> <h4 id="application-performance-monitoring"> <a href="#application-performance-monitoring" class="anchor-heading" aria-labelledby="application-performance-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Application Performance Monitoring </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/monitoring.ts</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">Sentry</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@sentry/nextjs</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">Sentry</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
  <span class="na">dsn</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SENTRY_DSN</span><span class="p">,</span>
  <span class="na">environment</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">,</span>
  <span class="nx">beforeSend</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Filter out non-critical errors</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">exception</span><span class="p">.</span><span class="nx">values</span><span class="p">?.[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">?.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">ChunkLoadError</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// Custom metrics</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">trackCustomMetric</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">tags</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Send to your monitoring service</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Metric: </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> = </span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">tags</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="database-query-monitoring"> <a href="#database-query-monitoring" class="anchor-heading" aria-labelledby="database-query-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Query Monitoring </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/prisma-monitoring.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PrismaClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@prisma/client</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">prisma</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PrismaClient</span><span class="p">({</span>
  <span class="na">log</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">emit</span><span class="p">:</span> <span class="dl">'</span><span class="s1">event</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">level</span><span class="p">:</span> <span class="dl">'</span><span class="s1">query</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">emit</span><span class="p">:</span> <span class="dl">'</span><span class="s1">event</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">level</span><span class="p">:</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">});</span>

<span class="nx">prisma</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="dl">'</span><span class="s1">query</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Slow query detected:</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">query</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span>
      <span class="na">duration</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span>
      <span class="na">params</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">params</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">prisma</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div><hr /> <h2 id="performance-optimization"> <a href="#performance-optimization" class="anchor-heading" aria-labelledby="performance-optimization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Performance Optimization </h2> <h3 id="frontend-performance"> <a href="#frontend-performance" class="anchor-heading" aria-labelledby="frontend-performance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Frontend Performance </h3> <h4 id="code-splitting-and-lazy-loading"> <a href="#code-splitting-and-lazy-loading" class="anchor-heading" aria-labelledby="code-splitting-and-lazy-loading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Splitting and Lazy Loading </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Dynamic imports for route-based code splitting</span>
<span class="k">import</span> <span class="nx">dynamic</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/dynamic</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">ClientDetails</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">@/components/features/clients/ClientDetails</span><span class="dl">'</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">loading</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">ClientDetailsSkeleton</span> <span class="o">/&gt;</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">DocumentViewer</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">@/components/features/documents/DocumentViewer</span><span class="dl">'</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// Disable SSR for heavy components</span>
<span class="p">});</span>

<span class="c1">// Lazy loading with intersection observer</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">lazy</span><span class="p">,</span> <span class="nx">Suspense</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">ExpensiveChart</span> <span class="o">=</span> <span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">@/components/charts/ExpensiveChart</span><span class="dl">'</span><span class="p">));</span>

<span class="kd">function</span> <span class="nx">Dashboard</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Suspense</span> <span class="nx">fallback</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">ChartSkeleton</span> <span class="o">/&gt;</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ExpensiveChart</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="sr">/Suspense</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="image-optimization"> <a href="#image-optimization" class="anchor-heading" aria-labelledby="image-optimization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Image Optimization </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/ui/OptimizedImage.tsx</span>
<span class="k">import</span> <span class="nx">Image</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/image</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">OptimizedImageProps</span> <span class="p">{</span>
  <span class="nl">src</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">alt</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">priority</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">OptimizedImage</span><span class="p">({</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">alt</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">priority</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">}:</span> <span class="nx">OptimizedImageProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Image</span>
      <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">src</span><span class="p">}</span>
      <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">alt</span><span class="p">}</span>
      <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="p">}</span>
      <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="nx">height</span><span class="p">}</span>
      <span class="nx">priority</span><span class="o">=</span><span class="p">{</span><span class="nx">priority</span><span class="p">}</span>
      <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">blur</span><span class="dl">"</span>
      <span class="nx">blurDataURL</span><span class="o">=</span><span class="dl">"</span><span class="s2">data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAIAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWEREiMxUf/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R//2Q==</span><span class="dl">"</span>
      <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">rounded-lg</span><span class="dl">"</span>
    <span class="o">/&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="virtual-scrolling-for-large-lists"> <a href="#virtual-scrolling-for-large-lists" class="anchor-heading" aria-labelledby="virtual-scrolling-for-large-lists"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Virtual Scrolling for Large Lists </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// components/ui/VirtualizedList.tsx</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FixedSizeList</span> <span class="k">as</span> <span class="nx">List</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-window</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">VirtualizedListProps</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">items</span><span class="p">:</span> <span class="nx">T</span><span class="p">[];</span>
  <span class="nl">height</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">itemHeight</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">renderItem</span><span class="p">:</span> <span class="p">(</span><span class="na">item</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">VirtualizedList</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">({</span>
  <span class="nx">items</span><span class="p">,</span>
  <span class="nx">height</span><span class="p">,</span>
  <span class="nx">itemHeight</span><span class="p">,</span>
  <span class="nx">renderItem</span>
<span class="p">}:</span> <span class="nx">VirtualizedListProps</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Row</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">style</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span> <span class="nl">style</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">CSSProperties</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">style</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">renderItem</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">index</span><span class="p">)}</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">List</span>
      <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="nx">height</span><span class="p">}</span>
      <span class="nx">itemCount</span><span class="o">=</span><span class="p">{</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span>
      <span class="nx">itemSize</span><span class="o">=</span><span class="p">{</span><span class="nx">itemHeight</span><span class="p">}</span>
      <span class="nx">itemData</span><span class="o">=</span><span class="p">{</span><span class="nx">items</span><span class="p">}</span>
    <span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">Row</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/List</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="backend-performance"> <a href="#backend-performance" class="anchor-heading" aria-labelledby="backend-performance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backend Performance </h3> <h4 id="database-query-optimization"> <a href="#database-query-optimization" class="anchor-heading" aria-labelledby="database-query-optimization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database Query Optimization </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Optimized queries with proper indexing</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getClientsWithDocuments</span><span class="p">(</span><span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">organizationId</span> <span class="p">},</span>
    <span class="na">include</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">documents</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">take</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="na">orderBy</span><span class="p">:</span> <span class="p">{</span> <span class="na">createdAt</span><span class="p">:</span> <span class="dl">'</span><span class="s1">desc</span><span class="dl">'</span> <span class="p">},</span>
        <span class="na">select</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">id</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">fileName</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">category</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">createdAt</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">_count</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">select</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">documents</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">notes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">orderBy</span><span class="p">:</span> <span class="p">{</span> <span class="na">businessName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Use dataloader for N+1 query prevention</span>
<span class="k">import</span> <span class="nx">DataLoader</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">dataloader</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">clientDocumentLoader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataLoader</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">clientIds</span><span class="p">:</span> <span class="kr">string</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">clientId</span><span class="p">:</span> <span class="p">{</span> <span class="na">in</span><span class="p">:</span> <span class="nx">clientIds</span> <span class="p">}</span> <span class="p">},</span>
    <span class="na">orderBy</span><span class="p">:</span> <span class="p">{</span> <span class="na">createdAt</span><span class="p">:</span> <span class="dl">'</span><span class="s1">desc</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">});</span>

  <span class="c1">// Group by clientId</span>
  <span class="kd">const</span> <span class="nx">grouped</span> <span class="o">=</span> <span class="nx">documents</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">acc</span><span class="p">[</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientId</span><span class="p">])</span> <span class="nx">acc</span><span class="p">[</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">acc</span><span class="p">[</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientId</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
  <span class="p">},</span> <span class="p">{}</span> <span class="k">as</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="k">typeof</span> <span class="nx">documents</span><span class="o">&gt;</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">clientIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">id</span> <span class="o">=&gt;</span> <span class="nx">grouped</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">||</span> <span class="p">[]);</span>
<span class="p">});</span>
</code></pre></div></div> <h4 id="caching-strategy"> <a href="#caching-strategy" class="anchor-heading" aria-labelledby="caching-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caching Strategy </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/cache.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Redis</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@upstash/redis</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">redis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Redis</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UPSTASH_REDIS_REST_URL</span><span class="o">!</span><span class="p">,</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">UPSTASH_REDIS_REST_TOKEN</span><span class="o">!</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">CacheService</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">async</span> <span class="kd">get</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cached</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">cached</span> <span class="k">as</span> <span class="nx">T</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache get error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="k">async</span> <span class="kd">set</span><span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">ttl</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">setex</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">ttl</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache set error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="k">async</span> <span class="nx">invalidate</span><span class="p">(</span><span class="nx">pattern</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">del</span><span class="p">(...</span><span class="nx">keys</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache invalidate error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage in API routes</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">searchParams</span> <span class="p">}</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">cacheKey</span> <span class="o">=</span> <span class="s2">`clients:</span><span class="p">${</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">toString</span><span class="p">()}</span><span class="s2">`</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">clients</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">CacheService</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">Client</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">clients</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clients</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getClients</span><span class="p">(</span><span class="nx">searchParams</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">CacheService</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">,</span> <span class="nx">clients</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// 5 minutes</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">clients</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="security-best-practices"> <a href="#security-best-practices" class="anchor-heading" aria-labelledby="security-best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Best Practices </h2> <h3 id="input-validation-and-sanitization"> <a href="#input-validation-and-sanitization" class="anchor-heading" aria-labelledby="input-validation-and-sanitization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Input Validation and Sanitization </h3> <h4 id="zod-schema-validation"> <a href="#zod-schema-validation" class="anchor-heading" aria-labelledby="zod-schema-validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Zod Schema Validation </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// schemas/validation.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">z</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">zod</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">clientSchema</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
  <span class="na">businessName</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Business name is required</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Business name too long</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^</span><span class="se">[</span><span class="sr">a-zA-Z0-9</span><span class="se">\s\-</span><span class="sr">&amp;.,</span><span class="se">]</span><span class="sr">+$/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Invalid characters in business name</span><span class="dl">'</span><span class="p">),</span>

  <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">email</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid email format</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Email too long</span><span class="dl">'</span><span class="p">),</span>

  <span class="na">taxId</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^</span><span class="se">\d{2}</span><span class="sr">-</span><span class="se">\d{7}</span><span class="sr">$/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Tax ID must be in format XX-XXXXXXX</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">optional</span><span class="p">(),</span>

  <span class="na">website</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="kr">string</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid URL format</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">optional</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">or</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">literal</span><span class="p">(</span><span class="dl">''</span><span class="p">)),</span>

  <span class="na">customFields</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">record</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="kr">any</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">optional</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">refine</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">;</span> <span class="c1">// Limit custom fields</span>
    <span class="p">},</span> <span class="dl">'</span><span class="s1">Too many custom fields</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div></div> <h4 id="sql-injection-prevention"> <a href="#sql-injection-prevention" class="anchor-heading" aria-labelledby="sql-injection-prevention"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL Injection Prevention </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Always use Prisma's type-safe queries</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">searchClients</span><span class="p">(</span><span class="nx">searchTerm</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">organizationId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// SAFE: Prisma handles parameterization</span>
  <span class="k">return</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
    <span class="na">where</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">organizationId</span><span class="p">,</span>
      <span class="na">OR</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">businessName</span><span class="p">:</span> <span class="p">{</span> <span class="na">contains</span><span class="p">:</span> <span class="nx">searchTerm</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">insensitive</span><span class="dl">'</span> <span class="p">}</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">primaryContactEmail</span><span class="p">:</span> <span class="p">{</span> <span class="na">contains</span><span class="p">:</span> <span class="nx">searchTerm</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">insensitive</span><span class="dl">'</span> <span class="p">}</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// NEVER do raw SQL with user input</span>
<span class="c1">// const results = await prisma.$queryRaw`SELECT * FROM clients WHERE name = ${searchTerm}`; // DANGEROUS!</span>
</code></pre></div></div> <h3 id="authentication-and-authorization"> <a href="#authentication-and-authorization" class="anchor-heading" aria-labelledby="authentication-and-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authentication and Authorization </h3> <h4 id="role-based-access-control"> <a href="#role-based-access-control" class="anchor-heading" aria-labelledby="role-based-access-control"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Role-Based Access Control </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/rbac.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">Permission</span> <span class="p">{</span>
  <span class="nx">CLIENT_CREATE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">client:create</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">CLIENT_READ</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">client:read</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">CLIENT_UPDATE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">client:update</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">CLIENT_DELETE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">client:delete</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">DOCUMENT_UPLOAD</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">document:upload</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">DOCUMENT_DELETE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">document:delete</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">USER_MANAGE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">user:manage</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">BILLING_MANAGE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">billing:manage</span><span class="dl">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">rolePermissions</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">Permission</span><span class="p">[]</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">owner</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">Permission</span><span class="p">),</span>
  <span class="na">admin</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_CREATE</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_READ</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_UPDATE</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">DOCUMENT_UPLOAD</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">USER_MANAGE</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">cpa</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_CREATE</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_READ</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_UPDATE</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">DOCUMENT_UPLOAD</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">staff</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">CLIENT_READ</span><span class="p">,</span>
    <span class="nx">Permission</span><span class="p">.</span><span class="nx">DOCUMENT_UPLOAD</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">hasPermission</span><span class="p">(</span><span class="nx">userRole</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">permission</span><span class="p">:</span> <span class="nx">Permission</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">rolePermissions</span><span class="p">[</span><span class="nx">userRole</span><span class="p">]?.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">permission</span><span class="p">)</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Middleware for API routes</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">requirePermission</span><span class="p">(</span><span class="nx">permission</span><span class="p">:</span> <span class="nx">Permission</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">middleware</span><span class="p">(</span>
    <span class="nx">handler</span><span class="p">:</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="nx">AuthContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="nx">AuthContext</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPermission</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">,</span> <span class="nx">permission</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
          <span class="p">{</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Insufficient permissions</span><span class="dl">'</span> <span class="p">},</span>
          <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">403</span> <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="secure-session-management"> <a href="#secure-session-management" class="anchor-heading" aria-labelledby="secure-session-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Secure Session Management </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/auth.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NextAuthOptions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next-auth</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PrismaAdapter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@next-auth/prisma-adapter</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">authOptions</span><span class="p">:</span> <span class="nx">NextAuthOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">adapter</span><span class="p">:</span> <span class="nx">PrismaAdapter</span><span class="p">(</span><span class="nx">prisma</span><span class="p">),</span>
  <span class="na">session</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">jwt</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">maxAge</span><span class="p">:</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="c1">// 8 hours</span>
  <span class="p">},</span>
  <span class="na">jwt</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">maxAge</span><span class="p">:</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="c1">// 8 hours</span>
  <span class="p">},</span>
  <span class="na">callbacks</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">jwt</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">token</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">account</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">token</span><span class="p">.</span><span class="nx">role</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">;</span>
        <span class="nx">token</span><span class="p">.</span><span class="nx">organizationId</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">token</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">session</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">session</span><span class="p">,</span> <span class="nx">token</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">sub</span><span class="o">!</span><span class="p">;</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">role</span> <span class="k">as</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">organizationId</span> <span class="k">as</span> <span class="kr">string</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">session</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">signIn</span><span class="p">:</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">account</span><span class="p">,</span> <span class="nx">isNewUser</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Log security event</span>
      <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">authEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="na">organizationId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">organizationId</span><span class="p">,</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SIGN_IN</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">ipAddress</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">,</span>
          <span class="na">userAgent</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">user-agent</span><span class="dl">'</span><span class="p">],</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="data-protection"> <a href="#data-protection" class="anchor-heading" aria-labelledby="data-protection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Protection </h3> <h4 id="encryption-at-rest"> <a href="#encryption-at-rest" class="anchor-heading" aria-labelledby="encryption-at-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encryption at Rest </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/encryption.ts</span>
<span class="k">import</span> <span class="nx">crypto</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">ENCRYPTION_KEY</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENCRYPTION_KEY</span><span class="o">!</span><span class="p">;</span> <span class="c1">// 32 bytes key</span>
<span class="kd">const</span> <span class="nx">ALGORITHM</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">aes-256-gcm</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="nx">ALGORITHM</span><span class="p">,</span> <span class="nx">ENCRYPTION_KEY</span><span class="p">);</span>
  <span class="nx">cipher</span><span class="p">.</span><span class="nx">setAAD</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">AdvisorOS</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>

  <span class="kd">let</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">encrypted</span> <span class="o">+=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">final</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">authTag</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">getAuthTag</span><span class="p">();</span>

  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">iv</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">:</span><span class="p">${</span><span class="nx">authTag</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">:</span><span class="p">${</span><span class="nx">encrypted</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">encryptedText</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">ivHex</span><span class="p">,</span> <span class="nx">authTagHex</span><span class="p">,</span> <span class="nx">encrypted</span><span class="p">]</span> <span class="o">=</span> <span class="nx">encryptedText</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">:</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">ivHex</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">authTag</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">authTagHex</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="nx">ALGORITHM</span><span class="p">,</span> <span class="nx">ENCRYPTION_KEY</span><span class="p">);</span>
  <span class="nx">decipher</span><span class="p">.</span><span class="nx">setAAD</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">AdvisorOS</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">));</span>
  <span class="nx">decipher</span><span class="p">.</span><span class="nx">setAuthTag</span><span class="p">(</span><span class="nx">authTag</span><span class="p">);</span>

  <span class="kd">let</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">decrypted</span> <span class="o">+=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">final</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">decrypted</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage for sensitive data</span>
<span class="kd">const</span> <span class="nx">encryptedTaxId</span> <span class="o">=</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">taxId</span><span class="p">);</span>
</code></pre></div></div> <h4 id="data-sanitization"> <a href="#data-sanitization" class="anchor-heading" aria-labelledby="data-sanitization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Sanitization </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/sanitize.ts</span>
<span class="k">import</span> <span class="nx">DOMPurify</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">isomorphic-dompurify</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">sanitizeHtml</span><span class="p">(</span><span class="nx">html</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">DOMPurify</span><span class="p">.</span><span class="nx">sanitize</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">ALLOWED_TAGS</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">i</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">em</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">strong</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">br</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">ALLOWED_ATTR</span><span class="p">:</span> <span class="p">[]</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">sanitizeFileName</span><span class="p">(</span><span class="nx">fileName</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fileName</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[^</span><span class="sr">a-zA-Z0-9.-</span><span class="se">]</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// Replace invalid chars</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/_</span><span class="se">{2,}</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// Replace multiple underscores</span>
    <span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span> <span class="c1">// Limit length</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">sanitizeSearchTerm</span><span class="p">(</span><span class="nx">term</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">term</span>
    <span class="p">.</span><span class="nx">trim</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">// Limit length</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[</span><span class="sr">&lt;&gt;</span><span class="se">]</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span> <span class="c1">// Remove potentially dangerous chars</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="deployment-process"> <a href="#deployment-process" class="anchor-heading" aria-labelledby="deployment-process"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deployment Process </h2> <h3 id="environment-configuration"> <a href="#environment-configuration" class="anchor-heading" aria-labelledby="environment-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment Configuration </h3> <h4 id="production-environment-variables"> <a href="#production-environment-variables" class="anchor-heading" aria-labelledby="production-environment-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Production Environment Variables </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .env.production</span>
<span class="nv">NODE_ENV</span><span class="o">=</span>production
<span class="nv">DATABASE_URL</span><span class="o">=</span><span class="s2">"postgresql://user:pass@prod-db:5432/advisoros_prod"</span>
<span class="nv">NEXTAUTH_SECRET</span><span class="o">=</span><span class="s2">"super-secure-secret-key"</span>
<span class="nv">NEXTAUTH_URL</span><span class="o">=</span><span class="s2">"https://advisoros.com"</span>

<span class="c"># External Services</span>
<span class="nv">QUICKBOOKS_CLIENT_ID</span><span class="o">=</span><span class="s2">"prod-qb-client-id"</span>
<span class="nv">QUICKBOOKS_CLIENT_SECRET</span><span class="o">=</span><span class="s2">"prod-qb-secret"</span>
<span class="nv">QUICKBOOKS_ENVIRONMENT</span><span class="o">=</span><span class="s2">"production"</span>

<span class="nv">STRIPE_SECRET_KEY</span><span class="o">=</span><span class="s2">"sk_live_..."</span>
<span class="nv">STRIPE_PUBLISHABLE_KEY</span><span class="o">=</span><span class="s2">"pk_live_..."</span>

<span class="c"># Azure Services</span>
<span class="nv">AZURE_STORAGE_CONNECTION_STRING</span><span class="o">=</span><span class="s2">"DefaultEndpointsProtocol=https;..."</span>

<span class="c"># Monitoring</span>
<span class="nv">SENTRY_DSN</span><span class="o">=</span><span class="s2">"https://..."</span>
<span class="nv">NEW_RELIC_LICENSE_KEY</span><span class="o">=</span><span class="s2">"..."</span>

<span class="c"># Security</span>
<span class="nv">ENCRYPTION_KEY</span><span class="o">=</span><span class="s2">"32-byte-encryption-key"</span>
</code></pre></div></div> <h3 id="docker-configuration"> <a href="#docker-configuration" class="anchor-heading" aria-labelledby="docker-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker Configuration </h3> <h4 id="multi-stage-dockerfile"> <a href="#multi-stage-dockerfile" class="anchor-heading" aria-labelledby="multi-stage-dockerfile"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-stage Dockerfile </h4> <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>

<span class="c"># Dependencies stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">deps</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> libc6-compat
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> package.json package-lock.json ./</span>
<span class="k">COPY</span><span class="s"> packages/*/package.json ./packages/*/</span>
<span class="k">RUN </span>npm ci <span class="nt">--only</span><span class="o">=</span>production

<span class="c"># Builder stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=deps /app/node_modules ./node_modules</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">ENV</span><span class="s"> NEXT_TELEMETRY_DISABLED 1</span>
<span class="k">RUN </span>npm run build

<span class="c"># Runner stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">runner</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">ENV</span><span class="s"> NODE_ENV production</span>
<span class="k">ENV</span><span class="s"> NEXT_TELEMETRY_DISABLED 1</span>

<span class="k">RUN </span>addgroup <span class="nt">--system</span> <span class="nt">--gid</span> 1001 nodejs
<span class="k">RUN </span>adduser <span class="nt">--system</span> <span class="nt">--uid</span> 1001 nextjs

<span class="k">COPY</span><span class="s"> --from=builder /app/public ./public</span>
<span class="k">COPY</span><span class="s"> --from=builder --chown=nextjs:nodejs /app/.next/standalone ./</span>
<span class="k">COPY</span><span class="s"> --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static</span>

<span class="k">USER</span><span class="s"> nextjs</span>

<span class="k">EXPOSE</span><span class="s"> 3000</span>
<span class="k">ENV</span><span class="s"> PORT 3000</span>

<span class="k">CMD</span><span class="s"> ["node", "server.js"]</span>
</code></pre></div></div> <h4 id="docker-compose-for-production"> <a href="#docker-compose-for-production" class="anchor-heading" aria-labelledby="docker-compose-for-production"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker Compose for Production </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.prod.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=${DATABASE_URL}</span>
      <span class="pi">-</span> <span class="s">NEXTAUTH_SECRET=${NEXTAUTH_SECRET}</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/api/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>

  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:14</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">advisoros_prod</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_data:/data</span>

  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx.conf:/etc/nginx/nginx.conf</span>
      <span class="pi">-</span> <span class="s">./ssl:/etc/nginx/ssl</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">redis_data</span><span class="pi">:</span>
</code></pre></div></div> <h3 id="cicd-pipeline"> <a href="#cicd-pipeline" class="anchor-heading" aria-labelledby="cicd-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CI/CD Pipeline </h3> <h4 id="github-actions-workflow"> <a href="#github-actions-workflow" class="anchor-heading" aria-labelledby="github-actions-workflow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GitHub Actions Workflow </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/deploy.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Production</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="m">18</span>
          <span class="na">cache</span><span class="pi">:</span> <span class="s1">'</span><span class="s">npm'</span>

      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm ci</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm run type-check</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm run lint</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm run test:coverage</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload coverage to Codecov</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">codecov/codecov-action@v3</span>

  <span class="na">build</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Docker Buildx</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/setup-buildx-action@v3</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Container Registry</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">registry</span><span class="pi">:</span> <span class="s">ghcr.io</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">$</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v5</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
          <span class="na">push</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">tags</span><span class="pi">:</span> <span class="s">ghcr.io/$:latest</span>
          <span class="na">cache-from</span><span class="pi">:</span> <span class="s">type=gha</span>
          <span class="na">cache-to</span><span class="pi">:</span> <span class="s">type=gha,mode=max</span>

  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to production</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">appleboy/ssh-action@v1.0.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">host</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">cd /app</span>
            <span class="s">docker-compose pull</span>
            <span class="s">docker-compose up -d</span>
            <span class="s">docker image prune -f</span>
</code></pre></div></div> <h3 id="health-checks-and-monitoring"> <a href="#health-checks-and-monitoring" class="anchor-heading" aria-labelledby="health-checks-and-monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Health Checks and Monitoring </h3> <h4 id="health-check-endpoint"> <a href="#health-check-endpoint" class="anchor-heading" aria-labelledby="health-check-endpoint"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Health Check Endpoint </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/api/health/route.ts</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">checks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">database</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">redis</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">storage</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Database check</span>
    <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">$queryRaw</span><span class="s2">`SELECT 1`</span><span class="p">;</span>
    <span class="nx">checks</span><span class="p">.</span><span class="nx">database</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database health check failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Redis check</span>
    <span class="k">await</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">ping</span><span class="p">();</span>
    <span class="nx">checks</span><span class="p">.</span><span class="nx">redis</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Redis health check failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Storage check</span>
    <span class="k">await</span> <span class="nx">azure</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">test</span><span class="p">();</span>
    <span class="nx">checks</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Storage health check failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">healthy</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">checks</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">Response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">healthy</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">healthy</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">unhealthy</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">checks</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="nx">healthy</span> <span class="p">?</span> <span class="mi">200</span> <span class="p">:</span> <span class="mi">503</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><hr /> <h2 id="contributing-guidelines"> <a href="#contributing-guidelines" class="anchor-heading" aria-labelledby="contributing-guidelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contributing Guidelines </h2> <h3 id="code-review-process"> <a href="#code-review-process" class="anchor-heading" aria-labelledby="code-review-process"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Review Process </h3> <h4 id="pull-request-template"> <a href="#pull-request-template" class="anchor-heading" aria-labelledby="pull-request-template"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pull Request Template </h4> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">## Description</span>
Brief description of changes

<span class="gu">## Type of Change</span>
<span class="p">-</span> [ ] Bug fix
<span class="p">-</span> [ ] New feature
<span class="p">-</span> [ ] Breaking change
<span class="p">-</span> [ ] Documentation update

<span class="gu">## Testing</span>
<span class="p">-</span> [ ] Tests pass locally
<span class="p">-</span> [ ] Added tests for new functionality
<span class="p">-</span> [ ] Updated documentation

<span class="gu">## Screenshots (if applicable)</span>

<span class="gu">## Checklist</span>
<span class="p">-</span> [ ] Code follows style guidelines
<span class="p">-</span> [ ] Self-review completed
<span class="p">-</span> [ ] Comments added for complex logic
<span class="p">-</span> [ ] No new warnings or errors
</code></pre></div></div> <h4 id="code-review-checklist"> <a href="#code-review-checklist" class="anchor-heading" aria-labelledby="code-review-checklist"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Review Checklist </h4> <ul> <li><strong>Functionality</strong>: Does the code work as intended?</li> <li><strong>Security</strong>: Are there any security vulnerabilities?</li> <li><strong>Performance</strong>: Are there any performance issues?</li> <li><strong>Maintainability</strong>: Is the code easy to understand and maintain?</li> <li><strong>Testing</strong>: Are there adequate tests?</li> <li><strong>Documentation</strong>: Is documentation updated?</li> </ul> <h3 id="development-standards"> <a href="#development-standards" class="anchor-heading" aria-labelledby="development-standards"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Development Standards </h3> <h4 id="typescript-guidelines"> <a href="#typescript-guidelines" class="anchor-heading" aria-labelledby="typescript-guidelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TypeScript Guidelines </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Use explicit return types for functions</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">calculateTotal</span><span class="p">(</span><span class="nx">items</span><span class="p">:</span> <span class="nx">LineItem</span><span class="p">[]):</span> <span class="kr">number</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">items</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">amount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Use proper error handling</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">createClient</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">CreateClientInput</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Result</span><span class="o">&lt;</span><span class="nx">Client</span><span class="p">,</span> <span class="nb">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">clientService</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="nx">client</span> <span class="p">};</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error</span> <span class="k">as</span> <span class="nb">Error</span> <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use branded types for IDs</span>
<span class="kd">type</span> <span class="nx">ClientId</span> <span class="o">=</span> <span class="kr">string</span> <span class="o">&amp;</span> <span class="p">{</span> <span class="k">readonly</span> <span class="na">brand</span><span class="p">:</span> <span class="nx">unique</span> <span class="nx">symbol</span> <span class="p">};</span>
<span class="kd">type</span> <span class="nx">OrganizationId</span> <span class="o">=</span> <span class="kr">string</span> <span class="o">&amp;</span> <span class="p">{</span> <span class="k">readonly</span> <span class="na">brand</span><span class="p">:</span> <span class="nx">unique</span> <span class="nx">symbol</span> <span class="p">};</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getClient</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="nx">ClientId</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Client</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="component-guidelines"> <a href="#component-guidelines" class="anchor-heading" aria-labelledby="component-guidelines"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Component Guidelines </h4> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Use proper prop interfaces</span>
<span class="kr">interface</span> <span class="nx">ClientCardProps</span> <span class="p">{</span>
  <span class="nl">client</span><span class="p">:</span> <span class="nx">Client</span><span class="p">;</span>
  <span class="nl">onEdit</span><span class="p">?:</span> <span class="p">(</span><span class="nx">client</span><span class="p">:</span> <span class="nx">Client</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">onDelete</span><span class="p">?:</span> <span class="p">(</span><span class="nx">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nl">className</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Use default props appropriately</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">ClientCard</span><span class="p">({</span>
  <span class="nx">client</span><span class="p">,</span>
  <span class="nx">onEdit</span><span class="p">,</span>
  <span class="nx">onDelete</span><span class="p">,</span>
  <span class="nx">className</span> <span class="o">=</span> <span class="dl">''</span>
<span class="p">}:</span> <span class="nx">ClientCardProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Component implementation</span>
<span class="p">}</span>

<span class="c1">// Export components with display names</span>
<span class="nx">ClientCard</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ClientCard</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div> <h3 id="release-process"> <a href="#release-process" class="anchor-heading" aria-labelledby="release-process"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Release Process </h3> <h4 id="semantic-versioning"> <a href="#semantic-versioning" class="anchor-heading" aria-labelledby="semantic-versioning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Semantic Versioning </h4> <ul> <li><strong>MAJOR</strong> (1.0.0): Breaking changes</li> <li><strong>MINOR</strong> (0.1.0): New features, backward compatible</li> <li><strong>PATCH</strong> (0.0.1): Bug fixes, backward compatible</li> </ul> <h4 id="release-checklist"> <a href="#release-checklist" class="anchor-heading" aria-labelledby="release-checklist"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Release Checklist </h4> <ol> <li><strong>Pre-release</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />All tests passing</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Documentation updated</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Changelog updated</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Version bumped</li> </ul> </li> <li><strong>Release</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Tagged release in Git</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Deployed to staging</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Smoke tests passed</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Deployed to production</li> </ul> </li> <li><strong>Post-release</strong>: <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Monitor for errors</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Update documentation</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Notify stakeholders</li> </ul> </li> </ol><hr /> <p>This comprehensive developer guide should provide your team with everything needed to work effectively with the AdvisorOS codebase. The architecture patterns, coding standards, and workflows outlined here will help maintain code quality and development velocity as the project scales.</p> <p>Remember to keep this documentation updated as the project evolves, and encourage team members to contribute improvements and clarifications based on their experiences.</p> </main> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Built by the AdvisorOS team | Updated {{ site.time | date: '%B %d, %Y' }}</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
